<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Analysis</title>

<script src="site_libs/header-attrs-2.8/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>


<link rel="stylesheet" href="my-style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Supporting material for pliman's paper</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa fa fa-home"></span>
     
    About
  </a>
</li>
<li>
  <a href="code.html">
    <span class="fa fa fa fa-file-code-o"></span>
     
    Analysis
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/TiagoOlivoto/paper_pliman">
    <span class="fas fa-github-square"></span>
     
    Source
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Analysis</h1>

</div>


<div id="packages" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> Packages</h1>
<pre class="r"><code>library(tidyverse) # data manipulation and plots
library(pliman) # plant image analysis
library(DescTools) # concordance correlation coefficient
library(rio) # import/export data</code></pre>
</div>
<div id="installing-pliman" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> Installing pliman</h1>
<p>To install the released version of <code>pliman</code> from CRAN type:</p>
<pre class="r"><code>install.packages(&quot;pliman&quot;)</code></pre>
<p>The latest development version of <code>pliman</code> can be installed from the GitHub repository. The installation process requires the <code>devtools</code> package, which needs to be installed first. If you are a Windows user, you should also first download and install the latest version of <a href="https://cran.r-project.org/bin/windows/Rtools/">Rtools</a>.</p>
<pre class="r"><code>if(!require(devtools)) install.packages(&quot;devtools&quot;)
</code></pre>
<p>After <code>devtools</code> properly installed, you can install <code>pliman</code> by running the following code. Please, note that the installation will also download the dependencies required to run the package.</p>
<pre class="r"><code>devtools::install_github(&quot;TiagoOlivoto/pliman&quot;)</code></pre>
<p>Them, load <code>pliman</code> by running</p>
<pre class="r"><code>
library(pliman)</code></pre>
</div>
<div id="image-manipulation" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> Image manipulation</h1>
<div id="importing-images" class="section level2" number="3.1">
<h2 number="3.1"><span class="header-section-number">3.1</span> Importing images</h2>
<pre class="r"><code>library(pliman)
soy &lt;- image_import(&quot;data/soy_grains.jpg&quot;)
soy2 &lt;- image_import(&quot;data/soy_grains_2.jpg&quot;)</code></pre>
<p>To import a list of images, the argument <code>img_pattern</code> of the function <code>image_import()</code> is used. All images that matches the pattern name are imported into a list.</p>
<pre class="r"><code># set a temporary working directory
setwd(&quot;data&quot;)
soy_list &lt;- image_import(img_pattern = &quot;soy_&quot;)
names(soy_list)
## [1] &quot;soy_exported.jpg&quot; &quot;soy_grains.jpg&quot;   &quot;soy_grains_2.JPG&quot;</code></pre>
</div>
<div id="displaying-images" class="section level2" number="3.2">
<h2 number="3.2"><span class="header-section-number">3.2</span> Displaying images</h2>
<p>Single images are displayed with <code>image_show()</code>. For combining images, the function <code>image_combine()</code> is used. Users can inform either a comma-separated list of objects or list of objects of class <code>Image</code>.</p>
<pre class="r"><code># Single images
image_show(soy)

# Combine images
image_combine(soy, soy2)</code></pre>
<p><img src="code_files/figure-html/display1-1.png" width="1152" /></p>
<pre class="r"><code>
# Combine images
image_combine(soy_list, ncol = 3)</code></pre>
<p><img src="code_files/figure-html/display1-2.png" width="1152" /></p>
</div>
<div id="manipulating-images" class="section level2" number="3.3">
<h2 number="3.3"><span class="header-section-number">3.3</span> Manipulating images</h2>
<p><code>pliman</code> provides useful functions to perform image transformation of unique images or list of images based on the <a href="https://www.bioconductor.org/packages/release/bioc/vignettes/EBImage/inst/doc/EBImage-introduction.html">EBImage package</a>. All the functions shown here works natturaly either with a single image or a list of images.</p>
<div id="rezise-an-image" class="section level3" number="3.3.1">
<h3 number="3.3.1"><span class="header-section-number">3.3.1</span> Rezise an image</h3>
<p><code>image_resize()</code> is used to resize an image. The argument <code>rel_size</code> can be used to resize the image by relative size. For example, setting <code>rel_size = 50</code> to an image of width 1280 x 720, the new image will have a size of 640 x 360. This is useful to speed up the time of analysis such as those computed with <code>count_objects</code> and <code>symptomatic_area()</code>.</p>
<pre class="r"><code>image_dimension(soy)
## 
## ----------------------
## Image dimension
## ----------------------
## Width :  1834 
## Height:  1305
soy_resized &lt;- image_resize(soy, rel_size = 50)
image_dimension(soy_resized)
## 
## ----------------------
## Image dimension
## ----------------------
## Width :  917 
## Height:  652</code></pre>
</div>
<div id="auto-crop" class="section level3" number="3.3.2">
<h3 number="3.3.2"><span class="header-section-number">3.3.2</span> Auto crop</h3>
<p>Cropping images is useful to remove noises from image edge, as well as to reduce the size of images before processing. <code>pliman</code> provides auto-cropping of images with <code>image_autocrop()</code>.</p>
<pre class="r"><code>soy_crop &lt;- image_autocrop(soy)
soy_crop2 &lt;- image_autocrop(soy, edge = 30) # add 30 pixels around objects&#39; area
image_combine(soy, soy_crop, soy_crop2, ncol = 3)</code></pre>
<p><img src="code_files/figure-html/manipulate2-1.png" width="1920" /></p>
</div>
<div id="rotate-an-image" class="section level3" number="3.3.3">
<h3 number="3.3.3"><span class="header-section-number">3.3.3</span> Rotate an image</h3>
<p><code>image_rotate()</code> is used to rotates the image clockwise by the given angle.</p>
<pre class="r"><code>soy_rotated &lt;- image_rotate(soy, angle = 45)
image_show(soy_rotated)</code></pre>
<p><img src="code_files/figure-html/manipulate3-1.png" width="672" /></p>
</div>
<div id="horizontal-and-vertical-reflection" class="section level3" number="3.3.4">
<h3 number="3.3.4"><span class="header-section-number">3.3.4</span> Horizontal and vertical reflection</h3>
<p><code>image_hreflect()</code> and <code>image_vreflect()</code> performs vertical and horizontal reflection of images, respectively.</p>
<pre class="r"><code>soy_hrefl &lt;- image_hreflect(soy)
soy_vrefl &lt;- image_vreflect(soy)
image_combine(soy, soy_hrefl, soy_vrefl, ncol = 3)</code></pre>
<p><img src="code_files/figure-html/manipulate4-1.png" width="1920" /></p>
</div>
<div id="horizontal-and-vertical-conversion" class="section level3" number="3.3.5">
<h3 number="3.3.5"><span class="header-section-number">3.3.5</span> Horizontal and vertical conversion</h3>
<p><code>image_horizontal()</code> and <code>image_vertical()</code> converts (if needed) an image to a horizontal or vertical image, respectively.</p>
<pre class="r"><code>soy_h &lt;- image_horizontal(soy)
soy_v &lt;- image_vertical(soy)
image_combine(soy, soy_h, soy_v, ncol = 3)</code></pre>
<p><img src="code_files/figure-html/manipulate5-1.png" width="1920" /></p>
</div>
<div id="filter-blur-and-contrast" class="section level3" number="3.3.6">
<h3 number="3.3.6"><span class="header-section-number">3.3.6</span> Filter, blur, and contrast</h3>
<pre class="r"><code>soy_filter &lt;- image_filter(soy)
soy_blur &lt;- image_blur(soy)
soy_contrast &lt;- image_contrast(soy)
image_combine(soy, soy_filter, soy_blur, soy_contrast)</code></pre>
<p><img src="code_files/figure-html/manipulate6-1.png" width="960" /></p>
</div>
<div id="exporting-images" class="section level3" number="3.3.7">
<h3 number="3.3.7"><span class="header-section-number">3.3.7</span> Exporting images</h3>
<p>To export images to the current directory, use the function <code>image_export()</code>.</p>
<pre class="r"><code>image_export(soy, &quot;soy_exported.jpg&quot;)</code></pre>
</div>
<div id="combining-functions" class="section level3" number="3.3.8">
<h3 number="3.3.8"><span class="header-section-number">3.3.8</span> Combining functions</h3>
<p><code>pliman</code> offers the possibility of combining functions with the new R base forward pipe operator <code>|&gt;</code>.</p>
<pre class="r"><code>setwd(&quot;data&quot;) # temporary directory
a &lt;- image_import(img_pattern = &quot;soy_grains&quot;)
image_combine(a)</code></pre>
<p><img src="code_files/figure-html/combiningfunct-1.png" width="960" /></p>
<pre class="r"><code>
# reduce resolution, autocrop, vertical rotation,
# create a binary image, export
a |&gt;
  image_resize(rel_size = 50) |&gt;
  image_autocrop() |&gt;
  image_vertical() |&gt;
  image_binary(index = &quot;NB&quot;, show_image = FALSE) |&gt;
  image_combine()</code></pre>
<p><img src="code_files/figure-html/combiningfunct-2.png" width="960" /></p>
</div>
</div>
</div>
<div id="image-segmentation" class="section level1" number="4">
<h1 number="4"><span class="header-section-number">4</span> Image segmentation</h1>
<p>In <code>pliman</code> the following functions can be used to segment an image.</p>
<ul>
<li><code>image_binary()</code> to produce a binary (black and white) image</li>
<li><code>image_segment()</code> to produce a segmented image (image objects and a white background).</li>
</ul>
<p>Both functions segment the image based on the value of some image index, which may be one of the RGB bands or any operation with these bands. Internally, these functions call <code>image_index()</code> to compute these indexes.</p>
<p>Here, we use the argument <code>index"</code> to test the segmentation based on the RGB and their normalized values. Users can also provide your index with the argument <code>my_index</code>.</p>
<pre class="r"><code>
soy &lt;- image_import(&quot;data/segmentation/soybean_touch.jpg&quot;)
image_show(soy)</code></pre>
<p><img src="code_files/figure-html/segmentation1-1.png" width="672" /></p>
<pre class="r"><code># Compute the indexes
indexes &lt;- image_index(soy, index = c(&quot;R, G, B, NR, NG, NB&quot;))</code></pre>
<p><img src="code_files/figure-html/segmentation2-1.png" width="960" /></p>
<pre class="r"><code>
# Create a histogram with the RGB values
plot(indexes)</code></pre>
<p><img src="code_files/figure-html/segmentation2-2.png" width="960" /></p>
<p>In this example, we can see the distribution of the RGB values (first row) and the normalized RGB values (second row). The two peaks represent the grains (smaller peak) and the blue background (larger peak). The clearer the difference between these peaks, the better will the image segmentation.</p>
<p>The function <code>image_segmentation()</code> is used to segment images using image indexes. In our example, we will use the same indexes computed below to see how the image is segmented. The output of this function can be used as input in the function <code>count_objets()</code>.</p>
<pre class="r"><code>segmented &lt;- image_segment(soy, index = c(&quot;R, G, B, NR, NG, NB&quot;))</code></pre>
<p><img src="code_files/figure-html/segmentation3-1.png" width="960" /></p>
<p>It seems that the “NB” index provided better segmentation. “R” and “NR” resulted in an inverted segmented image, i.e., the grains were considered as background and the remaining as ‘selected’ image. To circumvent this problem, we can use the argument <code>invert</code> in those functions.</p>
<pre class="r"><code>image_segment(soy,
              index = c(&quot;R, NR&quot;),
              invert = TRUE)</code></pre>
<p><img src="code_files/figure-html/segmentation4-1.png" width="960" /></p>
</div>
<div id="producing-a-binary-image" class="section level1" number="5">
<h1 number="5"><span class="header-section-number">5</span> Producing a binary image</h1>
<p>We can also produce a binary image with <code>image_binary()</code>. Just for curiosity, we will use the indexes <code>"R"</code> and <code>"NB"</code>. By default, <code>image_binary()</code> rescales the image to 30% of the size of the original image to speed up the computation time. Use the argument <code>resize = FALSE</code> to produce a binary image with the original size.</p>
<pre class="r"><code>binary &lt;- image_binary(soy, index = c(&quot;R, NB&quot;))</code></pre>
<p><img src="code_files/figure-html/binary1-1.png" width="960" /></p>
<pre class="r"><code>
# original image size
image_binary(soy,
             index = c(&quot;R, NB&quot;),
             resize = FALSE)</code></pre>
<p><img src="code_files/figure-html/binary1-2.png" width="960" /></p>
</div>
<div id="leaf-area" class="section level1" number="6">
<h1 number="6"><span class="header-section-number">6</span> Leaf area</h1>
<div id="leaf-area-using-leaf_area" class="section level2" number="6.1">
<h2 number="6.1"><span class="header-section-number">6.1</span> Leaf area using leaf_area()</h2>
<p>In this example, an image with five tree leaves and a yellow template with a know area of 4 cm<span class="math inline">\(^2\)</span> is used.</p>
<pre class="r"><code>img &lt;- image_import(&quot;data/leaf_area/la_pattern.JPG&quot;)
leaf &lt;- image_import(&quot;data/leaf_area/la_leaf.jpg&quot;)
tmpl &lt;- image_import(&quot;data/leaf_area/la_temp.jpg&quot;)
background &lt;- image_import(&quot;data/leaf_area/la_back.jpg&quot;)

# Combine the images
image_combine(img, leaf, tmpl, background)</code></pre>
<p><img src="code_files/figure-html/leaf1-1.png" width="672" /></p>
<p>To compute the leaf area in the image, the following function is used. Then, <code>get_measures()</code> is used to get the values given in the scale of <code>area_template</code> argument. The other measures (namely, perimeter, radius_mean, radius_min, and radius_max) are given as pixels.</p>
<pre class="r"><code>area &lt;- 
leaf_area(img = img,
          img_leaf = leaf,
          img_template = tmpl,
          img_background = background,
          area_template = 4,
          text_col = &quot;white&quot;)</code></pre>
<p><img src="code_files/figure-html/leaf2-1.png" width="672" /></p>
<pre class="r"><code>
# Get leaf measures
get_measures(area)
## -----------------------------------------
## Total leaf area  : 142.851 
## Average leaf area: 23.808 
## -----------------------------------------</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["id"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["x"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["y"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["area"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["perimeter"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["radius_mean"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["radius_min"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["radius_max"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["radius_sd"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["radius_ratio"],"name":[10],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"510.875","3":"194.809","4":"33.663","5":"751","6":"131.037","7":"113.016","8":"174.915","9":"15.328","10":"1.548","_rn_":"1"},{"1":"2","2":"206.665","3":"201.323","4":"27.054","5":"709","6":"119.479","7":"93.280","8":"170.673","9":"19.213","10":"1.830","_rn_":"2"},{"1":"3","2":"123.377","3":"557.367","4":"30.671","5":"787","6":"128.769","7":"95.739","8":"189.312","9":"24.556","10":"1.977","_rn_":"3"},{"1":"4","2":"623.024","3":"585.408","4":"39.360","5":"860","6":"143.404","7":"108.124","8":"202.987","9":"25.159","10":"1.877","_rn_":"4"},{"1":"5","2":"364.737","3":"508.624","4":"8.103","5":"375","6":"64.386","7":"51.685","8":"86.544","9":"9.695","10":"1.674","_rn_":"5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="leaf-area-using-count_objects" class="section level2" number="6.2">
<h2 number="6.2"><span class="header-section-number">6.2</span> Leaf area using count_objects()</h2>
<p>An alternative way to compute leaf area in <code>pliman</code> is by using <code>count_objects()</code>. This function has the advantage of using image segmentation based on several indexes (e.g., red, green, and blue values). So, sample palettes don’t need to be informed. Let us compute the leaf area of <code>leaves</code> with this approach. First, we use <code>image_segmentation()</code> to identify candidate indexes to segment the image.</p>
<pre class="r"><code>leaves &lt;- image_import(&quot;data/leaf_area/la_leaves.JPG&quot;)
image_show(leaves)</code></pre>
<p><img src="code_files/figure-html/leaf3-1.png" width="672" /></p>
<pre class="r"><code>image_segment(leaves, index = &quot;all&quot;)</code></pre>
<p><img src="code_files/figure-html/leaf4-1.png" width="768" /></p>
<p><code>G</code> (Green) and <code>NB</code> (Normalized Blue) are two possible candidates to segment the leaves from the background. We will use the <code>NB</code> index here (default option in <code>count_objects()</code>). The measurement of the leaf area in this approach is given with the following two steps.</p>
<ol style="list-style-type: decimal">
<li>Count the number of objects (leaves in this case)</li>
</ol>
<p>Here, we need to combine <code>count_objects()</code> and <code>plot_measures()</code> to obtain the identification of each leaf, allowing the further adjustment of the leaf area.</p>
<pre class="r"><code>count &lt;- count_objects(leaves, marker = &quot;text&quot;)</code></pre>
<p><img src="code_files/figure-html/leaf5-1.png" width="672" /></p>
<pre><code>## 
## --------------------------------------------
## Number of objects: 6 
## --------------------------------------------
##  statistics      area perimeter
##         min   4332.00  253.0000
##        mean  26704.17  533.5000
##         max  44763.00  727.0000
##          sd  16286.76  197.2265
##         sum 160225.00 3201.0000</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Adjust the leaf area by the area of the known object</li>
</ol>
<p>The function <code>get_measures()</code> is used to adjust the leaf area using the object 6.</p>
<pre class="r"><code>area &lt;- 
get_measures(count,
             id = 6,
             area ~ 4)
## -----------------------------------------
## measures corrected with:
## object id: 6
## area     : 4
## -----------------------------------------
## Total    : 147.946 
## Average  : 24.658 
## -----------------------------------------
area</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["id"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["x"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["y"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["area"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["perimeter"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["radius_mean"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["radius_min"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["radius_max"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["radius_sd"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["radius_ratio"],"name":[10],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"537.383","3":"498.991","4":"41.332","5":"22.091","6":"3.678","7":"2.756","8":"5.259","9":"21.470","10":"1.908","_rn_":"1"},{"1":"2","2":"438.651","3":"165.238","4":"35.363","5":"19.478","6":"3.371","7":"2.875","8":"4.547","9":"13.686","10":"1.582","_rn_":"2"},{"1":"3","2":"110.879","3":"477.028","4":"31.269","5":"20.116","6":"3.269","7":"2.375","8":"4.857","9":"21.497","10":"2.045","_rn_":"3"},{"1":"4","2":"178.420","3":"174.235","4":"27.446","5":"18.202","6":"3.027","7":"2.307","8":"4.395","9":"17.013","10":"1.904","_rn_":"4"},{"1":"5","2":"315.236","3":"434.611","4":"8.536","5":"9.693","6":"1.656","7":"1.312","8":"2.253","9":"8.583","10":"1.718","_rn_":"5"},{"1":"6","2":"313.491","3":"655.205","4":"4.000","5":"7.688","6":"1.125","7":"0.926","8":"1.379","9":"3.958","10":"1.488","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code># plot the area to the segmented image
image_segment(leaves, index = &quot;NB&quot;, verbose = FALSE)
plot_measures(area, measure = &quot;area&quot;)</code></pre>
<p><img src="code_files/figure-html/leaf6-1.png" width="672" /></p>
<pre class="r"><code>
# compute the difference between the two methods
142.9 -(sum(area$area) - 4)
## [1] -1.046</code></pre>
<p>The weakness of computing leaf area with <code>count_objects()</code> is that it is needed to first obtain the object identification to know which object (leaf) is the sample with a known area. This object id may change from image to image, especially from images with a different number of leaves. Thus, batch computing is difficult in this case.</p>
</div>
</div>
<div id="disease-severity" class="section level1" number="7">
<h1 number="7"><span class="header-section-number">7</span> Disease severity</h1>
<div id="single-images" class="section level2" number="7.1">
<h2 number="7.1"><span class="header-section-number">7.1</span> Single images</h2>
<pre class="r"><code># temporary directory
setwd(&quot;data/disease_severity/soybean&quot;)

# import images
img &lt;- image_import(&quot;sev_leaf.jpg&quot;)
healthy &lt;- image_import(&quot;sev_healthy.jpg&quot;)
symptoms &lt;- image_import(&quot;sev_sympt.jpg&quot;)
background &lt;- image_import(&quot;sev_back.jpg&quot;)
image_combine(img, healthy, symptoms, background, ncol = 4)</code></pre>
<p><img src="code_files/figure-html/disease1-1.png" width="1152" /></p>
<pre class="r"><code># default settings
res &lt;- 
symptomatic_area(img = img,
                 img_healthy = healthy,
                 img_symptoms = symptoms,
                 img_background = background,
                 save_image = TRUE,
                 dir_processed = &quot;data/disease_severity/soybean_rust/single&quot;)

# create a personalized mask
symptomatic_area(img = img,
                 img_healthy = healthy,
                 img_symptoms = symptoms,
                 img_background = background,
                 save_image = TRUE,
                 show_original = FALSE,
                 col_background = &quot;black&quot;,
                 dir_processed = &quot;data/disease_severity/soybean_rust/single2&quot;)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["healthy"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["symptomatic"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"89.40286","2":"10.59714"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>
# import generated masks
mask &lt;- image_import(&quot;data/disease_severity/soybean_rust/single/proc_img.jpg&quot;)
mask2 &lt;- image_import(&quot;data/disease_severity/soybean_rust/single2/proc_img.jpg&quot;)

# combine the masks with original image
image_combine(img, mask, mask2, ncol = 3)</code></pre>
<p><img src="code_files/figure-html/disease2-1.png" width="960" /></p>
</div>
<div id="batch-processing" class="section level2" number="7.2">
<h2 number="7.2"><span class="header-section-number">7.2</span> Batch processing</h2>
<div id="leaf-images" class="section level3" number="7.2.1">
<h3 number="7.2.1"><span class="header-section-number">7.2.1</span> leaf images</h3>
<p>Fifty soybean leaves previously processed in QUANT software were used. The images were retrieved from <a href="https://osf.io/4hbr6" class="uri">https://osf.io/4hbr6</a>, a Plant Disease Severity Annotation Image Database. Thanks to <a href="https://osf.io/jb6yd/">Emerson M. Del Ponte</a> and his collaborators for keeping this important project publicly available.</p>
<pre class="r"><code># temporary directory
setwd(&quot;data/disease_severity/soybean_rust&quot;)
soy_leaves &lt;- image_import(img_pattern = &quot;1&quot;)
image_combine(soy_leaves, ncol = 5)</code></pre>
<p><img src="code_files/figure-html/batch1-1.png" width="960" /></p>
</div>
<div id="severity-measurement" class="section level3" number="7.2.2">
<h3 number="7.2.2"><span class="header-section-number">7.2.2</span> Severity measurement</h3>
<pre class="r"><code>system.time(
soy_rust &lt;-
  symptomatic_area(img_pattern = &quot;1&quot;,
                   img_symptoms = &quot;soy_rust&quot;,
                   img_healthy = &quot;soy_leaf&quot;,
                   img_background = &quot;soy_bg&quot;,
                   dir_original = &quot;data/disease_severity/soybean_rust&quot;,
                   dir_processed = &quot;data/disease_severity/soybean_rust/processed&quot;,
                   save_image = TRUE,
                   show_image = FALSE,
                   parallel = TRUE)
)
## Image processing using multiple sessions (10). Please wait.
##   usuário   sistema decorrido 
##      0.08      0.06     35.11
soy_rust</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["sample"],"name":[1],"type":["chr"],"align":["left"]},{"label":["healthy"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["symptomatic"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"92.63820","3":"7.3617990"},{"1":"10","2":"85.12066","3":"14.8793354"},{"1":"11","2":"16.26811","3":"83.7318903"},{"1":"12","2":"65.86770","3":"34.1322977"},{"1":"13","2":"78.86907","3":"21.1309337"},{"1":"14","2":"64.21161","3":"35.7883924"},{"1":"15","2":"58.60875","3":"41.3912500"},{"1":"16","2":"43.42292","3":"56.5770800"},{"1":"17","2":"79.12635","3":"20.8736532"},{"1":"18","2":"55.19732","3":"44.8026776"},{"1":"19","2":"88.56457","3":"11.4354274"},{"1":"2","2":"63.96366","3":"36.0363410"},{"1":"20","2":"52.47445","3":"47.5255535"},{"1":"21","2":"99.76126","3":"0.2387423"},{"1":"22","2":"73.49228","3":"26.5077157"},{"1":"23","2":"30.80225","3":"69.1977525"},{"1":"24","2":"20.62060","3":"79.3794042"},{"1":"25","2":"82.75964","3":"17.2403648"},{"1":"26","2":"40.36018","3":"59.6398214"},{"1":"27","2":"34.17056","3":"65.8294355"},{"1":"28","2":"34.25100","3":"65.7489989"},{"1":"29","2":"75.52532","3":"24.4746831"},{"1":"3","2":"59.68355","3":"40.3164500"},{"1":"30","2":"73.84171","3":"26.1582930"},{"1":"31","2":"10.40481","3":"89.5951939"},{"1":"32","2":"27.95252","3":"72.0474766"},{"1":"33","2":"31.79678","3":"68.2032195"},{"1":"34","2":"52.94804","3":"47.0519608"},{"1":"35","2":"22.56888","3":"77.4311185"},{"1":"36","2":"43.14054","3":"56.8594560"},{"1":"37","2":"14.51621","3":"85.4837885"},{"1":"38","2":"45.71493","3":"54.2850663"},{"1":"39","2":"90.00157","3":"9.9984274"},{"1":"4","2":"44.20341","3":"55.7965930"},{"1":"40","2":"59.96537","3":"40.0346332"},{"1":"41","2":"93.25271","3":"6.7472892"},{"1":"42","2":"37.42507","3":"62.5749259"},{"1":"43","2":"53.96738","3":"46.0326162"},{"1":"44","2":"41.55406","3":"58.4459384"},{"1":"45","2":"67.37694","3":"32.6230574"},{"1":"46","2":"97.27265","3":"2.7273533"},{"1":"47","2":"86.25343","3":"13.7465707"},{"1":"48","2":"90.63191","3":"9.3680941"},{"1":"49","2":"58.44181","3":"41.5581905"},{"1":"5","2":"83.49901","3":"16.5009899"},{"1":"50","2":"83.86586","3":"16.1341422"},{"1":"50_2","2":"83.68398","3":"16.3160206"},{"1":"6","2":"75.39482","3":"24.6051805"},{"1":"7","2":"75.67301","3":"24.3269925"},{"1":"8","2":"70.30719","3":"29.6928050"},{"1":"9","2":"54.98060","3":"45.0194034"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="processed-images" class="section level3" number="7.2.3">
<h3 number="7.2.3"><span class="header-section-number">7.2.3</span> Processed images</h3>
<pre class="r"><code># temporary directory
setwd(&quot;data/disease_severity/soybean_rust/processed&quot;)
soy_leaves &lt;- image_import(img_pattern = &quot;proc&quot;)
image_combine(soy_leaves, ncol = 5)</code></pre>
<p><img src="code_files/figure-html/batch3-1.png" width="960" /></p>
</div>
</div>
<div id="concordance-correlation-coefficient" class="section level2" number="7.3">
<h2 number="7.3"><span class="header-section-number">7.3</span> Concordance correlation coefficient</h2>
<pre class="r"><code>bind &lt;- import(&quot;data/disease_severity/soybean_rust/data_quant_pliman.xlsx&quot;)
concordance &lt;- CCC(bind$Quant, bind$pliman)
concordance$rho.c</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["est"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["lwr.ci"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["upr.ci"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.9920766","2":"0.9873892","3":"0.9950261"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div id="count-objects" class="section level1" number="8">
<h1 number="8"><span class="header-section-number">8</span> Count objects</h1>
<div id="images" class="section level2" number="8.1">
<h2 number="8.1"><span class="header-section-number">8.1</span> Images</h2>
<pre class="r"><code>imgs &lt;- list(
been_blue = image_import(&quot;data/count_objects/been_blue/IMG_1254.jpg&quot;),
been_white = image_import(&quot;data/count_objects/been_white/IMG_1192.jpg&quot;),
soy_blue = image_import(&quot;data/count_objects/soy_blue/IMG_1266.jpg&quot;),
soy_white = image_import(&quot;data/count_objects/soy_white/IMG_1178.jpg&quot;),
wheat_blue = image_import(&quot;data/count_objects/wheat_blue/IMG_1280.jpg&quot;),
wheat_white = image_import(&quot;data/count_objects/wheat_white/IMG_1158.jpg&quot;)
)
image_combine(imgs, ncol = 2)</code></pre>
<p><img src="code_files/figure-html/count_imgs-1.png" width="960" /></p>
</div>
<div id="concordance" class="section level2" number="8.2">
<h2 number="8.2"><span class="header-section-number">8.2</span> Concordance</h2>
<pre class="r"><code>validation &lt;- import(&quot;data/count_objects/count_data.xlsx&quot;)
validation</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["RESOLUTION"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["CROP"],"name":[2],"type":["chr"],"align":["left"]},{"label":["BACKGROUND"],"name":[3],"type":["chr"],"align":["left"]},{"label":["ID"],"name":[4],"type":["chr"],"align":["left"]},{"label":["REAL"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["PREDICTED"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"50","2":"Been","3":"Blue","4":"IMG_1254","5":"98","6":"97","_rn_":"1"},{"1":"50","2":"Been","3":"Blue","4":"IMG_1255","5":"89","6":"89","_rn_":"2"},{"1":"50","2":"Been","3":"Blue","4":"IMG_1256","5":"77","6":"85","_rn_":"3"},{"1":"50","2":"Been","3":"Blue","4":"IMG_1257","5":"67","6":"73","_rn_":"4"},{"1":"50","2":"Been","3":"Blue","4":"IMG_1258","5":"59","6":"62","_rn_":"5"},{"1":"50","2":"Been","3":"Blue","4":"IMG_1259","5":"53","6":"53","_rn_":"6"},{"1":"50","2":"Been","3":"Blue","4":"IMG_1260","5":"51","6":"53","_rn_":"7"},{"1":"50","2":"Been","3":"Blue","4":"IMG_1261","5":"46","6":"45","_rn_":"8"},{"1":"50","2":"Been","3":"Blue","4":"IMG_1262","5":"39","6":"38","_rn_":"9"},{"1":"50","2":"Been","3":"Blue","4":"IMG_1263","5":"33","6":"33","_rn_":"10"},{"1":"50","2":"Been","3":"Blue","4":"IMG_1264","5":"29","6":"31","_rn_":"11"},{"1":"50","2":"Been","3":"Blue","4":"IMG_1265","5":"20","6":"22","_rn_":"12"},{"1":"50","2":"Been","3":"Blue","4":"IMG_1266","5":"12","6":"14","_rn_":"13"},{"1":"50","2":"Been","3":"White","4":"IMG_1191","5":"100","6":"85","_rn_":"14"},{"1":"50","2":"Been","3":"White","4":"IMG_1192","5":"91","6":"82","_rn_":"15"},{"1":"50","2":"Been","3":"White","4":"IMG_1193","5":"79","6":"64","_rn_":"16"},{"1":"50","2":"Been","3":"White","4":"IMG_1194","5":"69","6":"56","_rn_":"17"},{"1":"50","2":"Been","3":"White","4":"IMG_1195","5":"61","6":"57","_rn_":"18"},{"1":"50","2":"Been","3":"White","4":"IMG_1196","5":"55","6":"53","_rn_":"19"},{"1":"50","2":"Been","3":"White","4":"IMG_1197","5":"53","6":"49","_rn_":"20"},{"1":"50","2":"Been","3":"White","4":"IMG_1198","5":"48","6":"47","_rn_":"21"},{"1":"50","2":"Been","3":"White","4":"IMG_1199","5":"41","6":"38","_rn_":"22"},{"1":"50","2":"Been","3":"White","4":"IMG_1201","5":"31","6":"31","_rn_":"23"},{"1":"50","2":"Been","3":"White","4":"IMG_1202","5":"22","6":"21","_rn_":"24"},{"1":"50","2":"Been","3":"White","4":"IMG_1203","5":"14","6":"14","_rn_":"25"},{"1":"50","2":"Soybean","3":"Blue","4":"IMG_1266","5":"100","6":"100","_rn_":"26"},{"1":"50","2":"Soybean","3":"Blue","4":"IMG_1267","5":"90","6":"90","_rn_":"27"},{"1":"50","2":"Soybean","3":"Blue","4":"IMG_1268","5":"83","6":"83","_rn_":"28"},{"1":"50","2":"Soybean","3":"Blue","4":"IMG_1269","5":"75","6":"75","_rn_":"29"},{"1":"50","2":"Soybean","3":"Blue","4":"IMG_1270","5":"70","6":"70","_rn_":"30"},{"1":"50","2":"Soybean","3":"Blue","4":"IMG_1271","5":"60","6":"60","_rn_":"31"},{"1":"50","2":"Soybean","3":"Blue","4":"IMG_1272","5":"57","6":"57","_rn_":"32"},{"1":"50","2":"Soybean","3":"Blue","4":"IMG_1273","5":"48","6":"48","_rn_":"33"},{"1":"50","2":"Soybean","3":"Blue","4":"IMG_1274","5":"36","6":"36","_rn_":"34"},{"1":"50","2":"Soybean","3":"Blue","4":"IMG_1275","5":"29","6":"29","_rn_":"35"},{"1":"50","2":"Soybean","3":"Blue","4":"IMG_1276","5":"23","6":"23","_rn_":"36"},{"1":"50","2":"Soybean","3":"Blue","4":"IMG_1277","5":"15","6":"15","_rn_":"37"},{"1":"50","2":"Soybean","3":"Blue","4":"IMG_1278","5":"7","6":"7","_rn_":"38"},{"1":"50","2":"Soybean","3":"White","4":"IMG_1178","5":"100","6":"101","_rn_":"39"},{"1":"50","2":"Soybean","3":"White","4":"IMG_1179","5":"93","6":"93","_rn_":"40"},{"1":"50","2":"Soybean","3":"White","4":"IMG_1180","5":"85","6":"88","_rn_":"41"},{"1":"50","2":"Soybean","3":"White","4":"IMG_1181","5":"80","6":"80","_rn_":"42"},{"1":"50","2":"Soybean","3":"White","4":"IMG_1182","5":"70","6":"71","_rn_":"43"},{"1":"50","2":"Soybean","3":"White","4":"IMG_1183","5":"67","6":"66","_rn_":"44"},{"1":"50","2":"Soybean","3":"White","4":"IMG_1184","5":"58","6":"59","_rn_":"45"},{"1":"50","2":"Soybean","3":"White","4":"IMG_1185","5":"46","6":"46","_rn_":"46"},{"1":"50","2":"Soybean","3":"White","4":"IMG_1186","5":"39","6":"39","_rn_":"47"},{"1":"50","2":"Soybean","3":"White","4":"IMG_1187","5":"33","6":"34","_rn_":"48"},{"1":"50","2":"Soybean","3":"White","4":"IMG_1188","5":"25","6":"27","_rn_":"49"},{"1":"50","2":"Soybean","3":"White","4":"IMG_1189","5":"18","6":"18","_rn_":"50"},{"1":"50","2":"Soybean","3":"White","4":"IMG_1190","5":"9","6":"9","_rn_":"51"},{"1":"50","2":"Wheat","3":"Blue","4":"IMG_1280","5":"100","6":"100","_rn_":"52"},{"1":"50","2":"Wheat","3":"Blue","4":"IMG_1281","5":"93","6":"93","_rn_":"53"},{"1":"50","2":"Wheat","3":"Blue","4":"IMG_1282","5":"87","6":"87","_rn_":"54"},{"1":"50","2":"Wheat","3":"Blue","4":"IMG_1283","5":"80","6":"80","_rn_":"55"},{"1":"50","2":"Wheat","3":"Blue","4":"IMG_1284","5":"68","6":"68","_rn_":"56"},{"1":"50","2":"Wheat","3":"Blue","4":"IMG_1285","5":"61","6":"62","_rn_":"57"},{"1":"50","2":"Wheat","3":"Blue","4":"IMG_1286","5":"55","6":"54","_rn_":"58"},{"1":"50","2":"Wheat","3":"Blue","4":"IMG_1287","5":"47","6":"47","_rn_":"59"},{"1":"50","2":"Wheat","3":"Blue","4":"IMG_1288","5":"40","6":"40","_rn_":"60"},{"1":"50","2":"Wheat","3":"Blue","4":"IMG_1289","5":"32","6":"31","_rn_":"61"},{"1":"50","2":"Wheat","3":"Blue","4":"IMG_1290","5":"24","6":"23","_rn_":"62"},{"1":"50","2":"Wheat","3":"Blue","4":"IMG_1291","5":"18","6":"17","_rn_":"63"},{"1":"50","2":"Wheat","3":"Blue","4":"IMG_1292","5":"12","6":"12","_rn_":"64"},{"1":"50","2":"Wheat","3":"White","4":"IMG_1157","5":"100","6":"99","_rn_":"65"},{"1":"50","2":"Wheat","3":"White","4":"IMG_1158","5":"93","6":"91","_rn_":"66"},{"1":"50","2":"Wheat","3":"White","4":"IMG_1159","5":"87","6":"86","_rn_":"67"},{"1":"50","2":"Wheat","3":"White","4":"IMG_1160","5":"80","6":"80","_rn_":"68"},{"1":"50","2":"Wheat","3":"White","4":"IMG_1161","5":"68","6":"67","_rn_":"69"},{"1":"50","2":"Wheat","3":"White","4":"IMG_1162","5":"61","6":"61","_rn_":"70"},{"1":"50","2":"Wheat","3":"White","4":"IMG_1163","5":"55","6":"55","_rn_":"71"},{"1":"50","2":"Wheat","3":"White","4":"IMG_1164","5":"47","6":"47","_rn_":"72"},{"1":"50","2":"Wheat","3":"White","4":"IMG_1165","5":"40","6":"40","_rn_":"73"},{"1":"50","2":"Wheat","3":"White","4":"IMG_1166","5":"32","6":"32","_rn_":"74"},{"1":"50","2":"Wheat","3":"White","4":"IMG_1167","5":"24","6":"24","_rn_":"75"},{"1":"50","2":"Wheat","3":"White","4":"IMG_1168","5":"18","6":"18","_rn_":"76"},{"1":"50","2":"Wheat","3":"White","4":"IMG_1169","5":"12","6":"12","_rn_":"77"},{"1":"100","2":"Been","3":"Blue","4":"IMG_1254","5":"98","6":"91","_rn_":"78"},{"1":"100","2":"Been","3":"Blue","4":"IMG_1255","5":"89","6":"85","_rn_":"79"},{"1":"100","2":"Been","3":"Blue","4":"IMG_1256","5":"77","6":"75","_rn_":"80"},{"1":"100","2":"Been","3":"Blue","4":"IMG_1257","5":"67","6":"66","_rn_":"81"},{"1":"100","2":"Been","3":"Blue","4":"IMG_1258","5":"59","6":"59","_rn_":"82"},{"1":"100","2":"Been","3":"Blue","4":"IMG_1259","5":"53","6":"52","_rn_":"83"},{"1":"100","2":"Been","3":"Blue","4":"IMG_1260","5":"51","6":"51","_rn_":"84"},{"1":"100","2":"Been","3":"Blue","4":"IMG_1261","5":"46","6":"44","_rn_":"85"},{"1":"100","2":"Been","3":"Blue","4":"IMG_1262","5":"39","6":"39","_rn_":"86"},{"1":"100","2":"Been","3":"Blue","4":"IMG_1263","5":"33","6":"32","_rn_":"87"},{"1":"100","2":"Been","3":"Blue","4":"IMG_1264","5":"29","6":"30","_rn_":"88"},{"1":"100","2":"Been","3":"Blue","4":"IMG_1265","5":"20","6":"21","_rn_":"89"},{"1":"100","2":"Been","3":"Blue","4":"IMG_1266","5":"12","6":"12","_rn_":"90"},{"1":"100","2":"Been","3":"White","4":"IMG_1191","5":"100","6":"84","_rn_":"91"},{"1":"100","2":"Been","3":"White","4":"IMG_1192","5":"91","6":"81","_rn_":"92"},{"1":"100","2":"Been","3":"White","4":"IMG_1193","5":"79","6":"59","_rn_":"93"},{"1":"100","2":"Been","3":"White","4":"IMG_1194","5":"69","6":"59","_rn_":"94"},{"1":"100","2":"Been","3":"White","4":"IMG_1195","5":"61","6":"55","_rn_":"95"},{"1":"100","2":"Been","3":"White","4":"IMG_1196","5":"55","6":"53","_rn_":"96"},{"1":"100","2":"Been","3":"White","4":"IMG_1197","5":"53","6":"49","_rn_":"97"},{"1":"100","2":"Been","3":"White","4":"IMG_1198","5":"48","6":"46","_rn_":"98"},{"1":"100","2":"Been","3":"White","4":"IMG_1199","5":"41","6":"37","_rn_":"99"},{"1":"100","2":"Been","3":"White","4":"IMG_1201","5":"31","6":"31","_rn_":"100"},{"1":"100","2":"Been","3":"White","4":"IMG_1202","5":"22","6":"21","_rn_":"101"},{"1":"100","2":"Been","3":"White","4":"IMG_1203","5":"14","6":"14","_rn_":"102"},{"1":"100","2":"Soybean","3":"Blue","4":"IMG_1266","5":"100","6":"100","_rn_":"103"},{"1":"100","2":"Soybean","3":"Blue","4":"IMG_1267","5":"90","6":"90","_rn_":"104"},{"1":"100","2":"Soybean","3":"Blue","4":"IMG_1268","5":"83","6":"83","_rn_":"105"},{"1":"100","2":"Soybean","3":"Blue","4":"IMG_1269","5":"75","6":"75","_rn_":"106"},{"1":"100","2":"Soybean","3":"Blue","4":"IMG_1270","5":"70","6":"70","_rn_":"107"},{"1":"100","2":"Soybean","3":"Blue","4":"IMG_1271","5":"60","6":"60","_rn_":"108"},{"1":"100","2":"Soybean","3":"Blue","4":"IMG_1272","5":"57","6":"57","_rn_":"109"},{"1":"100","2":"Soybean","3":"Blue","4":"IMG_1273","5":"48","6":"48","_rn_":"110"},{"1":"100","2":"Soybean","3":"Blue","4":"IMG_1274","5":"36","6":"36","_rn_":"111"},{"1":"100","2":"Soybean","3":"Blue","4":"IMG_1275","5":"29","6":"29","_rn_":"112"},{"1":"100","2":"Soybean","3":"Blue","4":"IMG_1276","5":"23","6":"23","_rn_":"113"},{"1":"100","2":"Soybean","3":"Blue","4":"IMG_1277","5":"15","6":"15","_rn_":"114"},{"1":"100","2":"Soybean","3":"Blue","4":"IMG_1278","5":"7","6":"7","_rn_":"115"},{"1":"100","2":"Soybean","3":"White","4":"IMG_1178","5":"100","6":"100","_rn_":"116"},{"1":"100","2":"Soybean","3":"White","4":"IMG_1179","5":"93","6":"93","_rn_":"117"},{"1":"100","2":"Soybean","3":"White","4":"IMG_1180","5":"85","6":"85","_rn_":"118"},{"1":"100","2":"Soybean","3":"White","4":"IMG_1181","5":"80","6":"80","_rn_":"119"},{"1":"100","2":"Soybean","3":"White","4":"IMG_1182","5":"70","6":"70","_rn_":"120"},{"1":"100","2":"Soybean","3":"White","4":"IMG_1183","5":"67","6":"66","_rn_":"121"},{"1":"100","2":"Soybean","3":"White","4":"IMG_1184","5":"58","6":"59","_rn_":"122"},{"1":"100","2":"Soybean","3":"White","4":"IMG_1185","5":"46","6":"46","_rn_":"123"},{"1":"100","2":"Soybean","3":"White","4":"IMG_1186","5":"39","6":"39","_rn_":"124"},{"1":"100","2":"Soybean","3":"White","4":"IMG_1187","5":"33","6":"33","_rn_":"125"},{"1":"100","2":"Soybean","3":"White","4":"IMG_1188","5":"25","6":"26","_rn_":"126"},{"1":"100","2":"Soybean","3":"White","4":"IMG_1189","5":"18","6":"18","_rn_":"127"},{"1":"100","2":"Soybean","3":"White","4":"IMG_1190","5":"9","6":"9","_rn_":"128"},{"1":"100","2":"Wheat","3":"Blue","4":"IMG_1280","5":"100","6":"100","_rn_":"129"},{"1":"100","2":"Wheat","3":"Blue","4":"IMG_1281","5":"93","6":"93","_rn_":"130"},{"1":"100","2":"Wheat","3":"Blue","4":"IMG_1282","5":"87","6":"86","_rn_":"131"},{"1":"100","2":"Wheat","3":"Blue","4":"IMG_1283","5":"80","6":"79","_rn_":"132"},{"1":"100","2":"Wheat","3":"Blue","4":"IMG_1284","5":"68","6":"68","_rn_":"133"},{"1":"100","2":"Wheat","3":"Blue","4":"IMG_1285","5":"61","6":"61","_rn_":"134"},{"1":"100","2":"Wheat","3":"Blue","4":"IMG_1286","5":"55","6":"54","_rn_":"135"},{"1":"100","2":"Wheat","3":"Blue","4":"IMG_1287","5":"47","6":"47","_rn_":"136"},{"1":"100","2":"Wheat","3":"Blue","4":"IMG_1288","5":"40","6":"40","_rn_":"137"},{"1":"100","2":"Wheat","3":"Blue","4":"IMG_1289","5":"32","6":"32","_rn_":"138"},{"1":"100","2":"Wheat","3":"Blue","4":"IMG_1290","5":"24","6":"24","_rn_":"139"},{"1":"100","2":"Wheat","3":"Blue","4":"IMG_1291","5":"18","6":"18","_rn_":"140"},{"1":"100","2":"Wheat","3":"Blue","4":"IMG_1292","5":"12","6":"12","_rn_":"141"},{"1":"100","2":"Wheat","3":"White","4":"IMG_1157","5":"100","6":"102","_rn_":"142"},{"1":"100","2":"Wheat","3":"White","4":"IMG_1158","5":"93","6":"91","_rn_":"143"},{"1":"100","2":"Wheat","3":"White","4":"IMG_1159","5":"87","6":"87","_rn_":"144"},{"1":"100","2":"Wheat","3":"White","4":"IMG_1160","5":"80","6":"80","_rn_":"145"},{"1":"100","2":"Wheat","3":"White","4":"IMG_1161","5":"68","6":"69","_rn_":"146"},{"1":"100","2":"Wheat","3":"White","4":"IMG_1162","5":"61","6":"61","_rn_":"147"},{"1":"100","2":"Wheat","3":"White","4":"IMG_1163","5":"55","6":"57","_rn_":"148"},{"1":"100","2":"Wheat","3":"White","4":"IMG_1164","5":"47","6":"48","_rn_":"149"},{"1":"100","2":"Wheat","3":"White","4":"IMG_1165","5":"40","6":"40","_rn_":"150"},{"1":"100","2":"Wheat","3":"White","4":"IMG_1166","5":"32","6":"33","_rn_":"151"},{"1":"100","2":"Wheat","3":"White","4":"IMG_1167","5":"24","6":"24","_rn_":"152"},{"1":"100","2":"Wheat","3":"White","4":"IMG_1168","5":"18","6":"18","_rn_":"153"},{"1":"100","2":"Wheat","3":"White","4":"IMG_1169","5":"12","6":"12","_rn_":"154"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code># helper function to compute the concordance correlation coefficient
get_ccc &lt;- function(df, real, predicted){
  real &lt;- pull(df, {{real}})
  predicted &lt;- pull(df, {{predicted}})
  CCC(real, predicted)$rho.c
}
### overall concordance
get_ccc(validation, REAL, PREDICTED)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["est"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["lwr.ci"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["upr.ci"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.9914214","2":"0.9883048","3":"0.9937102"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>### concordance by crop, resolution and background color
validation %&gt;% 
  group_by(RESOLUTION, CROP, BACKGROUND) %&gt;% 
  do(get_ccc(., REAL, PREDICTED))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["RESOLUTION"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["CROP"],"name":[2],"type":["chr"],"align":["left"]},{"label":["BACKGROUND"],"name":[3],"type":["chr"],"align":["left"]},{"label":["est"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["lwr.ci"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["upr.ci"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"50","2":"Been","3":"Blue","4":"0.9922569","5":"0.9759088","6":"0.9975252"},{"1":"50","2":"Been","3":"White","4":"0.9437796","5":"0.8686096","6":"0.9764852"},{"1":"50","2":"Soybean","3":"Blue","4":"1.0000000","5":"NaN","6":"NaN"},{"1":"50","2":"Soybean","3":"White","4":"0.9991538","5":"0.9973359","6":"0.9997314"},{"1":"50","2":"Wheat","3":"Blue","4":"0.9997601","5":"0.9993097","6":"0.9999166"},{"1":"50","2":"Wheat","3":"White","4":"0.9996554","5":"0.9991462","6":"0.9998610"},{"1":"100","2":"Been","3":"Blue","4":"0.9948546","5":"0.9883495","6":"0.9977317"},{"1":"100","2":"Been","3":"White","4":"0.9292020","5":"0.8350891","6":"0.9704699"},{"1":"100","2":"Soybean","3":"Blue","4":"1.0000000","5":"NaN","6":"NaN"},{"1":"100","2":"Soybean","3":"White","4":"0.9998576","5":"0.9995485","6":"0.9999551"},{"1":"100","2":"Wheat","3":"Blue","4":"0.9998539","5":"0.9995590","6":"0.9999516"},{"1":"100","2":"Wheat","3":"White","4":"0.9992734","5":"0.9976446","6":"0.9997760"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>### identity line
ggplot(validation, aes(REAL, PREDICTED))+
  geom_point(aes(color = factor(CROP))) +
  geom_smooth(method = &quot;lm&quot;, se = FALSE) +
  geom_abline(intercept = 0 , slope = 1, linetype = 2) +
  facet_grid(BACKGROUND ~ RESOLUTION) +
  labs(x = &quot;Actual number of grains&quot;,
       y = &quot;Counted number of grains&quot;) +
  theme(legend.position = &quot;bottom&quot;,
        legend.title = element_blank(),
        axis.ticks.length = unit(0.2, &quot;cm&quot;),
        panel.grid.minor = element_blank(),
        panel.spacing = unit(0.2, &quot;cm&quot;),
        axis.text = element_text(color = &quot;black&quot;, size = 12),
        axis.title = element_text(color = &quot;black&quot;, size = 12))+
  coord_fixed() +
  scale_x_continuous(limits = c(0, 110),
                     breaks = seq(0, 110, by = 25)) +
  scale_y_continuous(limits = c(0, 110),
                     breaks = seq(0, 110, by = 25))
## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="code_files/figure-html/count1-1.png" width="672" /></p>
</div>
</div>
<div id="rgb-for-each-image-objects" class="section level1" number="9">
<h1 number="9"><span class="header-section-number">9</span> RGB for each image objects</h1>
<pre class="r"><code>
img &lt;- image_import(&quot;data/objects_rgb/thetrazolium.jpg&quot;)

# identify the index that better segments the image
image_segment(img, index = &quot;all&quot;, ncol = 4)</code></pre>
<p><img src="code_files/figure-html/rgb1-1.png" width="960" /></p>
<div id="get-the-rgb-values-for-each-object" class="section level2" number="9.1">
<h2 number="9.1"><span class="header-section-number">9.1</span> Get the RGB values for each object</h2>
<p>The index <code>NB</code> was chosen to segment the grains from background. The mean of blue values will be computed by declaring <code>object_index = "B"</code>.</p>
<pre class="r"><code>ids &lt;- 
  objects_rgb(img, 
              index = &quot;NB&quot;, # (default) used to segment objects from background
              object_index = &quot;B&quot;, # Show the mean of blue values for each object
              object_size = &quot;elarge&quot;)</code></pre>
<p><img src="code_files/figure-html/rgb2-1.png" width="960" /></p>
<pre class="r"><code>plot(ids)</code></pre>
<p><img src="code_files/figure-html/rgb2-2.png" width="960" /></p>
</div>
<div id="plot-the-index" class="section level2" number="9.2">
<h2 number="9.2"><span class="header-section-number">9.2</span> plot the index</h2>
<p>Here, I use <code>image_segment()</code> and <code>plot_measures()</code> to plot the mean of blue values for each object.</p>
<pre class="r"><code>image_segment(img,
              index = &quot;NB&quot;,
              verbose = FALSE)
plot_measures(ids,
              measure = &quot;index&quot;, # plot the mean of blue values for each object
              col = &quot;black&quot;)</code></pre>
<p><img src="code_files/figure-html/rgb3-1.png" width="960" /></p>
<p>It seems that grains with mean blue values higher than 0.3 presents some level of damage. Users can then work with this feature and adapt it to your own case.</p>
<pre class="r"><code>length(which(ids$indexes$index &gt; 0.3))
## [1] 17</code></pre>
</div>
</div>

<div id="rmd-source-code">JSBBbmFseXNpcyANCg0KYGBge3IgZ2xvYmFsX29wdGlvbnMsIGluY2x1ZGUgPSBGQUxTRX0NCmtuaXRyOjpvcHRzX2NodW5rJHNldChjYWNoZSA9IFRSVUUsIGNvbW1lbnQgPSAiIyMiLCBjb2xsYXBzZSA9IFRSVUUpDQoNCmBgYA0KDQojIFBhY2thZ2VzDQpgYGB7ciBwYWNrYWdlcywgd2FybmluZz1GQUxTRX0NCmxpYnJhcnkodGlkeXZlcnNlKSAjIGRhdGEgbWFuaXB1bGF0aW9uIGFuZCBwbG90cw0KbGlicmFyeShwbGltYW4pICMgcGxhbnQgaW1hZ2UgYW5hbHlzaXMNCmxpYnJhcnkoRGVzY1Rvb2xzKSAjIGNvbmNvcmRhbmNlIGNvcnJlbGF0aW9uIGNvZWZmaWNpZW50DQpsaWJyYXJ5KHJpbykgIyBpbXBvcnQvZXhwb3J0IGRhdGENCmBgYA0KDQoNCiMgSW5zdGFsbGluZyBwbGltYW4NCg0KVG8gaW5zdGFsbCB0aGUgcmVsZWFzZWQgdmVyc2lvbiBvZiBgcGxpbWFuYCBmcm9tIENSQU4gdHlwZToNCmBgYHtyIGV2YWwgPSBGQUxTRX0NCmluc3RhbGwucGFja2FnZXMoInBsaW1hbiIpDQpgYGANCg0KDQpUaGUgbGF0ZXN0IGRldmVsb3BtZW50IHZlcnNpb24gb2YgYHBsaW1hbmAgY2FuIGJlIGluc3RhbGxlZCBmcm9tIHRoZSBHaXRIdWIgcmVwb3NpdG9yeS4gVGhlIGluc3RhbGxhdGlvbiBwcm9jZXNzIHJlcXVpcmVzIHRoZSBgZGV2dG9vbHNgIHBhY2thZ2UsIHdoaWNoIG5lZWRzIHRvIGJlIGluc3RhbGxlZCBmaXJzdC4gSWYgeW91IGFyZSBhIFdpbmRvd3MgdXNlciwgeW91IHNob3VsZCBhbHNvIGZpcnN0IGRvd25sb2FkIGFuZCBpbnN0YWxsIHRoZSBsYXRlc3QgdmVyc2lvbiBvZiBbUnRvb2xzXShodHRwczovL2NyYW4uci1wcm9qZWN0Lm9yZy9iaW4vd2luZG93cy9SdG9vbHMvKS4NCg0KYGBge3IsIGV2YWw9RkFMU0V9DQppZighcmVxdWlyZShkZXZ0b29scykpIGluc3RhbGwucGFja2FnZXMoImRldnRvb2xzIikNCg0KYGBgDQoNCkFmdGVyIGBkZXZ0b29sc2AgcHJvcGVybHkgaW5zdGFsbGVkLCB5b3UgY2FuIGluc3RhbGwgYHBsaW1hbmAgYnkgcnVubmluZyB0aGUgZm9sbG93aW5nIGNvZGUuIFBsZWFzZSwgbm90ZSB0aGF0IHRoZSBpbnN0YWxsYXRpb24gd2lsbCBhbHNvIGRvd25sb2FkIHRoZSBkZXBlbmRlbmNpZXMgcmVxdWlyZWQgdG8gcnVuIHRoZSBwYWNrYWdlLg0KDQpgYGB7ciwgZXZhbD1GQUxTRX0NCmRldnRvb2xzOjppbnN0YWxsX2dpdGh1YigiVGlhZ29PbGl2b3RvL3BsaW1hbiIpDQpgYGANCg0KDQpUaGVtLCBsb2FkIGBwbGltYW5gIGJ5IHJ1bm5pbmcgDQpgYGB7ciBsb2FkLCBtZXNzYWdlPUZBTFNFLCB3YXJuaW5nPUZBTFNFfQ0KDQpsaWJyYXJ5KHBsaW1hbikNCmBgYA0KDQoNCiMgSW1hZ2UgbWFuaXB1bGF0aW9uDQoNCiMjIEltcG9ydGluZyBpbWFnZXMNCg0KYGBge3IgaW1wb3J0MSB9DQpsaWJyYXJ5KHBsaW1hbikNCnNveSA8LSBpbWFnZV9pbXBvcnQoImRhdGEvc295X2dyYWlucy5qcGciKQ0Kc295MiA8LSBpbWFnZV9pbXBvcnQoImRhdGEvc295X2dyYWluc18yLmpwZyIpDQoNCmBgYA0KDQoNClRvIGltcG9ydCBhIGxpc3Qgb2YgaW1hZ2VzLCB0aGUgYXJndW1lbnQgYGltZ19wYXR0ZXJuYCBvZiB0aGUgZnVuY3Rpb24gYGltYWdlX2ltcG9ydCgpYCBpcyB1c2VkLiBBbGwgaW1hZ2VzIHRoYXQgbWF0Y2hlcyB0aGUgcGF0dGVybiBuYW1lIGFyZSBpbXBvcnRlZCBpbnRvIGEgbGlzdC4NCg0KYGBge3IgaW1wb3J0MiB9DQojIHNldCBhIHRlbXBvcmFyeSB3b3JraW5nIGRpcmVjdG9yeQ0Kc2V0d2QoImRhdGEiKQ0Kc295X2xpc3QgPC0gaW1hZ2VfaW1wb3J0KGltZ19wYXR0ZXJuID0gInNveV8iKQ0KbmFtZXMoc295X2xpc3QpDQpgYGANCg0KDQoNCg0KIyMgRGlzcGxheWluZyBpbWFnZXMNClNpbmdsZSBpbWFnZXMgYXJlIGRpc3BsYXllZCB3aXRoIGBpbWFnZV9zaG93KClgLiBGb3IgY29tYmluaW5nIGltYWdlcywgdGhlIGZ1bmN0aW9uIGBpbWFnZV9jb21iaW5lKClgIGlzIHVzZWQuIFVzZXJzIGNhbiBpbmZvcm0gZWl0aGVyIGEgY29tbWEtc2VwYXJhdGVkIGxpc3Qgb2Ygb2JqZWN0cyBvciBsaXN0IG9mIG9iamVjdHMgb2YgY2xhc3MgYEltYWdlYC4NCg0KYGBge3IgZGlzcGxheTEsIGZpZy53aWR0aD0xMn0NCiMgU2luZ2xlIGltYWdlcw0KaW1hZ2Vfc2hvdyhzb3kpDQoNCiMgQ29tYmluZSBpbWFnZXMNCmltYWdlX2NvbWJpbmUoc295LCBzb3kyKQ0KDQojIENvbWJpbmUgaW1hZ2VzDQppbWFnZV9jb21iaW5lKHNveV9saXN0LCBuY29sID0gMykNCg0KDQpgYGANCg0KDQojIyBNYW5pcHVsYXRpbmcgaW1hZ2VzDQoNCg0KYHBsaW1hbmAgcHJvdmlkZXMgdXNlZnVsIGZ1bmN0aW9ucyB0byBwZXJmb3JtIGltYWdlIHRyYW5zZm9ybWF0aW9uIG9mIHVuaXF1ZSBpbWFnZXMgb3IgbGlzdCBvZiBpbWFnZXMgYmFzZWQgb24gdGhlIFtFQkltYWdlIHBhY2thZ2VdKGh0dHBzOi8vd3d3LmJpb2NvbmR1Y3Rvci5vcmcvcGFja2FnZXMvcmVsZWFzZS9iaW9jL3ZpZ25ldHRlcy9FQkltYWdlL2luc3QvZG9jL0VCSW1hZ2UtaW50cm9kdWN0aW9uLmh0bWwpLiBBbGwgdGhlIGZ1bmN0aW9ucyBzaG93biBoZXJlIHdvcmtzIG5hdHR1cmFseSBlaXRoZXIgd2l0aCBhIHNpbmdsZSBpbWFnZSBvciBhIGxpc3Qgb2YgaW1hZ2VzLg0KDQojIyMgUmV6aXNlIGFuIGltYWdlDQpgaW1hZ2VfcmVzaXplKClgIGlzIHVzZWQgdG8gcmVzaXplIGFuIGltYWdlLiBUaGUgYXJndW1lbnQgYHJlbF9zaXplYCBjYW4gYmUgdXNlZCB0byByZXNpemUgdGhlIGltYWdlIGJ5IHJlbGF0aXZlIHNpemUuIEZvciBleGFtcGxlLCBzZXR0aW5nIGByZWxfc2l6ZSA9IDUwYCB0byBhbiBpbWFnZSBvZiB3aWR0aCAxMjgwIHggNzIwLCB0aGUgbmV3IGltYWdlIHdpbGwgaGF2ZSBhIHNpemUgb2YgNjQwIHggMzYwLiBUaGlzIGlzIHVzZWZ1bCB0byBzcGVlZCB1cCB0aGUgdGltZSBvZiBhbmFseXNpcyBzdWNoIGFzIHRob3NlIGNvbXB1dGVkIHdpdGggYGNvdW50X29iamVjdHNgIGFuZCBgc3ltcHRvbWF0aWNfYXJlYSgpYC4NCg0KYGBge3IgbWFuaXB1bGF0ZTF9DQppbWFnZV9kaW1lbnNpb24oc295KQ0Kc295X3Jlc2l6ZWQgPC0gaW1hZ2VfcmVzaXplKHNveSwgcmVsX3NpemUgPSA1MCkNCmltYWdlX2RpbWVuc2lvbihzb3lfcmVzaXplZCkNCmBgYA0KDQojIyMgQXV0byBjcm9wDQpDcm9wcGluZyBpbWFnZXMgaXMgdXNlZnVsIHRvIHJlbW92ZSBub2lzZXMgZnJvbSBpbWFnZSBlZGdlLCBhcyB3ZWxsIGFzIHRvIHJlZHVjZSB0aGUgc2l6ZSBvZiBpbWFnZXMgYmVmb3JlIHByb2Nlc3NpbmcuIGBwbGltYW5gIHByb3ZpZGVzIGF1dG8tY3JvcHBpbmcgb2YgaW1hZ2VzIHdpdGggYGltYWdlX2F1dG9jcm9wKClgLiANCg0KYGBge3IgbWFuaXB1bGF0ZTIsIGZpZy53aWR0aD0yMH0NCnNveV9jcm9wIDwtIGltYWdlX2F1dG9jcm9wKHNveSkNCnNveV9jcm9wMiA8LSBpbWFnZV9hdXRvY3JvcChzb3ksIGVkZ2UgPSAzMCkgIyBhZGQgMzAgcGl4ZWxzIGFyb3VuZCBvYmplY3RzJyBhcmVhDQppbWFnZV9jb21iaW5lKHNveSwgc295X2Nyb3AsIHNveV9jcm9wMiwgbmNvbCA9IDMpDQpgYGANCg0KDQojIyMgUm90YXRlIGFuIGltYWdlDQpgaW1hZ2Vfcm90YXRlKClgIGlzIHVzZWQgdG8gcm90YXRlcyB0aGUgaW1hZ2UgY2xvY2t3aXNlIGJ5IHRoZSBnaXZlbiBhbmdsZS4NCg0KYGBge3IgbWFuaXB1bGF0ZTMgfQ0Kc295X3JvdGF0ZWQgPC0gaW1hZ2Vfcm90YXRlKHNveSwgYW5nbGUgPSA0NSkNCmltYWdlX3Nob3coc295X3JvdGF0ZWQpDQpgYGANCg0KDQojIyMgSG9yaXpvbnRhbCBhbmQgdmVydGljYWwgcmVmbGVjdGlvbg0KYGltYWdlX2hyZWZsZWN0KClgIGFuZCBgaW1hZ2VfdnJlZmxlY3QoKWAgcGVyZm9ybXMgdmVydGljYWwgYW5kIGhvcml6b250YWwgcmVmbGVjdGlvbiBvZiBpbWFnZXMsIHJlc3BlY3RpdmVseS4NCg0KYGBge3IgbWFuaXB1bGF0ZTQsIGZpZy53aWR0aD0yMH0NCnNveV9ocmVmbCA8LSBpbWFnZV9ocmVmbGVjdChzb3kpDQpzb3lfdnJlZmwgPC0gaW1hZ2VfdnJlZmxlY3Qoc295KQ0KaW1hZ2VfY29tYmluZShzb3ksIHNveV9ocmVmbCwgc295X3ZyZWZsLCBuY29sID0gMykNCmBgYA0KDQoNCg0KIyMjIEhvcml6b250YWwgYW5kIHZlcnRpY2FsIGNvbnZlcnNpb24NCmBpbWFnZV9ob3Jpem9udGFsKClgIGFuZCBgaW1hZ2VfdmVydGljYWwoKWAgY29udmVydHMgKGlmIG5lZWRlZCkgYW4gaW1hZ2UgdG8gYSBob3Jpem9udGFsIG9yIHZlcnRpY2FsIGltYWdlLCByZXNwZWN0aXZlbHkuDQoNCmBgYHtyIG1hbmlwdWxhdGU1LCBmaWcud2lkdGg9MjB9DQpzb3lfaCA8LSBpbWFnZV9ob3Jpem9udGFsKHNveSkNCnNveV92IDwtIGltYWdlX3ZlcnRpY2FsKHNveSkNCmltYWdlX2NvbWJpbmUoc295LCBzb3lfaCwgc295X3YsIG5jb2wgPSAzKQ0KDQpgYGANCg0KDQojIyMgRmlsdGVyLCBibHVyLCBhbmQgY29udHJhc3QNCg0KYGBge3IgbWFuaXB1bGF0ZTYsIGZpZy53aWR0aD0xMCwgZmlnLmhlaWdodD0xMH0NCnNveV9maWx0ZXIgPC0gaW1hZ2VfZmlsdGVyKHNveSkNCnNveV9ibHVyIDwtIGltYWdlX2JsdXIoc295KQ0Kc295X2NvbnRyYXN0IDwtIGltYWdlX2NvbnRyYXN0KHNveSkNCmltYWdlX2NvbWJpbmUoc295LCBzb3lfZmlsdGVyLCBzb3lfYmx1ciwgc295X2NvbnRyYXN0KQ0KYGBgDQoNCg0KDQojIyMgRXhwb3J0aW5nIGltYWdlcw0KVG8gZXhwb3J0IGltYWdlcyB0byB0aGUgY3VycmVudCBkaXJlY3RvcnksIHVzZSB0aGUgZnVuY3Rpb24gYGltYWdlX2V4cG9ydCgpYC4NCg0KYGBge3IgZXhwb3J0fQ0KaW1hZ2VfZXhwb3J0KHNveSwgInNveV9leHBvcnRlZC5qcGciKQ0KYGBgDQoNCiMjIyBDb21iaW5pbmcgZnVuY3Rpb25zDQpgcGxpbWFuYCBvZmZlcnMgdGhlIHBvc3NpYmlsaXR5IG9mIGNvbWJpbmluZyBmdW5jdGlvbnMgd2l0aCB0aGUgbmV3IFIgYmFzZSBmb3J3YXJkIHBpcGUgb3BlcmF0b3IgYHw+YC4NCg0KYGBge3IgY29tYmluaW5nZnVuY3QsIGZpZy53aWR0aD0xMCwgZmlnLmhlaWdodD01fQ0Kc2V0d2QoImRhdGEiKSAjIHRlbXBvcmFyeSBkaXJlY3RvcnkNCmEgPC0gaW1hZ2VfaW1wb3J0KGltZ19wYXR0ZXJuID0gInNveV9ncmFpbnMiKQ0KaW1hZ2VfY29tYmluZShhKQ0KDQojIHJlZHVjZSByZXNvbHV0aW9uLCBhdXRvY3JvcCwgdmVydGljYWwgcm90YXRpb24sDQojIGNyZWF0ZSBhIGJpbmFyeSBpbWFnZSwgZXhwb3J0DQphIHw+DQogIGltYWdlX3Jlc2l6ZShyZWxfc2l6ZSA9IDUwKSB8Pg0KICBpbWFnZV9hdXRvY3JvcCgpIHw+DQogIGltYWdlX3ZlcnRpY2FsKCkgfD4NCiAgaW1hZ2VfYmluYXJ5KGluZGV4ID0gIk5CIiwgc2hvd19pbWFnZSA9IEZBTFNFKSB8Pg0KICBpbWFnZV9jb21iaW5lKCkNCmBgYA0KDQoNCg0KIyBJbWFnZSBzZWdtZW50YXRpb24NCg0KSW4gYHBsaW1hbmAgdGhlIGZvbGxvd2luZyBmdW5jdGlvbnMgY2FuIGJlIHVzZWQgdG8gc2VnbWVudCBhbiBpbWFnZS4NCg0KKiBgaW1hZ2VfYmluYXJ5KClgIHRvIHByb2R1Y2UgYSBiaW5hcnkgKGJsYWNrIGFuZCB3aGl0ZSkgaW1hZ2UNCiogYGltYWdlX3NlZ21lbnQoKWAgdG8gcHJvZHVjZSBhIHNlZ21lbnRlZCBpbWFnZSAoaW1hZ2Ugb2JqZWN0cyBhbmQgYSB3aGl0ZSBiYWNrZ3JvdW5kKS4NCg0KQm90aCBmdW5jdGlvbnMgc2VnbWVudCB0aGUgaW1hZ2UgYmFzZWQgb24gdGhlIHZhbHVlIG9mIHNvbWUgaW1hZ2UgaW5kZXgsIHdoaWNoIG1heSBiZSBvbmUgb2YgdGhlIFJHQiBiYW5kcyBvciBhbnkgb3BlcmF0aW9uIHdpdGggdGhlc2UgYmFuZHMuIEludGVybmFsbHksIHRoZXNlIGZ1bmN0aW9ucyBjYWxsIGBpbWFnZV9pbmRleCgpYCB0byBjb21wdXRlIHRoZXNlIGluZGV4ZXMuIA0KDQpIZXJlLCB3ZSB1c2UgdGhlIGFyZ3VtZW50IGBpbmRleCJgIHRvIHRlc3QgdGhlIHNlZ21lbnRhdGlvbiBiYXNlZCBvbiB0aGUgUkdCIGFuZCB0aGVpciBub3JtYWxpemVkIHZhbHVlcy4gVXNlcnMgY2FuIGFsc28gcHJvdmlkZSB5b3VyIGluZGV4IHdpdGggdGhlIGFyZ3VtZW50IGBteV9pbmRleGAuDQoNCmBgYHtyIHNlZ21lbnRhdGlvbjEgfQ0KDQpzb3kgPC0gaW1hZ2VfaW1wb3J0KCJkYXRhL3NlZ21lbnRhdGlvbi9zb3liZWFuX3RvdWNoLmpwZyIpDQppbWFnZV9zaG93KHNveSkNCg0KDQpgYGANCg0KYGBge3Igc2VnbWVudGF0aW9uMiwgZmlnLndpZHRoPTEwLCBmaWcuaGVpZ2h0PTV9DQojIENvbXB1dGUgdGhlIGluZGV4ZXMNCmluZGV4ZXMgPC0gaW1hZ2VfaW5kZXgoc295LCBpbmRleCA9IGMoIlIsIEcsIEIsIE5SLCBORywgTkIiKSkNCg0KIyBDcmVhdGUgYSBoaXN0b2dyYW0gd2l0aCB0aGUgUkdCIHZhbHVlcw0KcGxvdChpbmRleGVzKQ0KYGBgDQoNCkluIHRoaXMgZXhhbXBsZSwgd2UgY2FuIHNlZSB0aGUgZGlzdHJpYnV0aW9uIG9mIHRoZSBSR0IgdmFsdWVzIChmaXJzdCByb3cpIGFuZCB0aGUgbm9ybWFsaXplZCBSR0IgdmFsdWVzIChzZWNvbmQgcm93KS4gVGhlIHR3byBwZWFrcyByZXByZXNlbnQgdGhlIGdyYWlucyAoc21hbGxlciBwZWFrKSBhbmQgdGhlIGJsdWUgYmFja2dyb3VuZCAobGFyZ2VyIHBlYWspLiBUaGUgY2xlYXJlciB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIHRoZXNlIHBlYWtzLCB0aGUgYmV0dGVyIHdpbGwgdGhlIGltYWdlIHNlZ21lbnRhdGlvbi4NCg0KVGhlIGZ1bmN0aW9uIGBpbWFnZV9zZWdtZW50YXRpb24oKWAgaXMgdXNlZCB0byBzZWdtZW50IGltYWdlcyB1c2luZyBpbWFnZSBpbmRleGVzLiBJbiBvdXIgZXhhbXBsZSwgd2Ugd2lsbCB1c2UgdGhlIHNhbWUgaW5kZXhlcyBjb21wdXRlZCBiZWxvdyB0byBzZWUgaG93IHRoZSBpbWFnZSBpcyBzZWdtZW50ZWQuIFRoZSBvdXRwdXQgb2YgdGhpcyBmdW5jdGlvbiBjYW4gYmUgdXNlZCBhcyBpbnB1dCBpbiB0aGUgZnVuY3Rpb24gYGNvdW50X29iamV0cygpYC4NCg0KYGBge3Igc2VnbWVudGF0aW9uMywgZmlnLndpZHRoPTEwLCBmaWcuaGVpZ2h0PTV9DQpzZWdtZW50ZWQgPC0gaW1hZ2Vfc2VnbWVudChzb3ksIGluZGV4ID0gYygiUiwgRywgQiwgTlIsIE5HLCBOQiIpKQ0KDQpgYGANCg0KSXQgc2VlbXMgdGhhdCB0aGUgIk5CIiBpbmRleCBwcm92aWRlZCBiZXR0ZXIgc2VnbWVudGF0aW9uLiAiUiIgYW5kICJOUiIgcmVzdWx0ZWQgaW4gYW4gaW52ZXJ0ZWQgc2VnbWVudGVkIGltYWdlLCBpLmUuLCB0aGUgZ3JhaW5zIHdlcmUgY29uc2lkZXJlZCBhcyBiYWNrZ3JvdW5kIGFuZCB0aGUgcmVtYWluaW5nIGFzICdzZWxlY3RlZCcgaW1hZ2UuIFRvIGNpcmN1bXZlbnQgdGhpcyBwcm9ibGVtLCB3ZSBjYW4gdXNlIHRoZSBhcmd1bWVudCBgaW52ZXJ0YCBpbiB0aG9zZSBmdW5jdGlvbnMuDQoNCmBgYHtyIHNlZ21lbnRhdGlvbjQsIGZpZy53aWR0aD0xMCwgZmlnLmhlaWdodD01fQ0KaW1hZ2Vfc2VnbWVudChzb3ksDQogICAgICAgICAgICAgIGluZGV4ID0gYygiUiwgTlIiKSwNCiAgICAgICAgICAgICAgaW52ZXJ0ID0gVFJVRSkNCg0KYGBgDQoNCg0KIyBQcm9kdWNpbmcgYSBiaW5hcnkgaW1hZ2UNCg0KV2UgY2FuIGFsc28gcHJvZHVjZSBhIGJpbmFyeSBpbWFnZSB3aXRoIGBpbWFnZV9iaW5hcnkoKWAuIEp1c3QgZm9yIGN1cmlvc2l0eSwgd2Ugd2lsbCB1c2UgdGhlIGluZGV4ZXMgYCJSImAgYW5kIGAiTkIiYC4gQnkgZGVmYXVsdCwgYGltYWdlX2JpbmFyeSgpYCByZXNjYWxlcyB0aGUgaW1hZ2UgdG8gMzAlIG9mIHRoZSBzaXplIG9mIHRoZSBvcmlnaW5hbCBpbWFnZSB0byBzcGVlZCB1cCB0aGUgY29tcHV0YXRpb24gdGltZS4gVXNlIHRoZSBhcmd1bWVudCBgcmVzaXplID0gRkFMU0VgIHRvIHByb2R1Y2UgYSBiaW5hcnkgaW1hZ2Ugd2l0aCB0aGUgb3JpZ2luYWwgc2l6ZS4NCg0KYGBge3IgYmluYXJ5MSwgZmlnLndpZHRoPTEwLCBmaWcuaGVpZ2h0PTV9DQpiaW5hcnkgPC0gaW1hZ2VfYmluYXJ5KHNveSwgaW5kZXggPSBjKCJSLCBOQiIpKQ0KDQojIG9yaWdpbmFsIGltYWdlIHNpemUNCmltYWdlX2JpbmFyeShzb3ksDQogICAgICAgICAgICAgaW5kZXggPSBjKCJSLCBOQiIpLA0KICAgICAgICAgICAgIHJlc2l6ZSA9IEZBTFNFKQ0KYGBgDQoNCg0KIyBMZWFmIGFyZWENCiMjIExlYWYgYXJlYSB1c2luZyBsZWFmX2FyZWEoKQ0KDQpJbiB0aGlzIGV4YW1wbGUsIGFuIGltYWdlIHdpdGggZml2ZSB0cmVlIGxlYXZlcyBhbmQgYSB5ZWxsb3cgdGVtcGxhdGUgd2l0aCBhIGtub3cgYXJlYSBvZiA0IGNtJF4yJCBpcyB1c2VkLg0KDQpgYGB7ciBsZWFmMX0NCmltZyA8LSBpbWFnZV9pbXBvcnQoImRhdGEvbGVhZl9hcmVhL2xhX3BhdHRlcm4uSlBHIikNCmxlYWYgPC0gaW1hZ2VfaW1wb3J0KCJkYXRhL2xlYWZfYXJlYS9sYV9sZWFmLmpwZyIpDQp0bXBsIDwtIGltYWdlX2ltcG9ydCgiZGF0YS9sZWFmX2FyZWEvbGFfdGVtcC5qcGciKQ0KYmFja2dyb3VuZCA8LSBpbWFnZV9pbXBvcnQoImRhdGEvbGVhZl9hcmVhL2xhX2JhY2suanBnIikNCg0KIyBDb21iaW5lIHRoZSBpbWFnZXMNCmltYWdlX2NvbWJpbmUoaW1nLCBsZWFmLCB0bXBsLCBiYWNrZ3JvdW5kKQ0KYGBgDQoNCg0KDQpUbyBjb21wdXRlIHRoZSBsZWFmIGFyZWEgaW4gdGhlIGltYWdlLCB0aGUgZm9sbG93aW5nIGZ1bmN0aW9uIGlzIHVzZWQuIFRoZW4sIGBnZXRfbWVhc3VyZXMoKWAgaXMgdXNlZCB0byBnZXQgdGhlIHZhbHVlcyBnaXZlbiBpbiB0aGUgc2NhbGUgb2YgYGFyZWFfdGVtcGxhdGVgIGFyZ3VtZW50LiBUaGUgb3RoZXIgbWVhc3VyZXMgKG5hbWVseSwgcGVyaW1ldGVyLCByYWRpdXNfbWVhbiwgcmFkaXVzX21pbiwgYW5kIHJhZGl1c19tYXgpIGFyZSBnaXZlbiBhcyBwaXhlbHMuDQoNCmBgYHtyIGxlYWYyfQ0KYXJlYSA8LSANCmxlYWZfYXJlYShpbWcgPSBpbWcsDQogICAgICAgICAgaW1nX2xlYWYgPSBsZWFmLA0KICAgICAgICAgIGltZ190ZW1wbGF0ZSA9IHRtcGwsDQogICAgICAgICAgaW1nX2JhY2tncm91bmQgPSBiYWNrZ3JvdW5kLA0KICAgICAgICAgIGFyZWFfdGVtcGxhdGUgPSA0LA0KICAgICAgICAgIHRleHRfY29sID0gIndoaXRlIikNCg0KIyBHZXQgbGVhZiBtZWFzdXJlcw0KZ2V0X21lYXN1cmVzKGFyZWEpDQoNCmBgYA0KDQoNCiMjIExlYWYgYXJlYSB1c2luZyBjb3VudF9vYmplY3RzKCkNCg0KQW4gYWx0ZXJuYXRpdmUgd2F5IHRvIGNvbXB1dGUgbGVhZiBhcmVhIGluIGBwbGltYW5gIGlzIGJ5IHVzaW5nIGBjb3VudF9vYmplY3RzKClgLiBUaGlzIGZ1bmN0aW9uIGhhcyB0aGUgYWR2YW50YWdlIG9mIHVzaW5nIGltYWdlIHNlZ21lbnRhdGlvbiBiYXNlZCBvbiBzZXZlcmFsIGluZGV4ZXMgKGUuZy4sIHJlZCwgZ3JlZW4sIGFuZCBibHVlIHZhbHVlcykuIFNvLCBzYW1wbGUgcGFsZXR0ZXMgZG9uJ3QgbmVlZCB0byBiZSBpbmZvcm1lZC4gTGV0IHVzIGNvbXB1dGUgdGhlIGxlYWYgYXJlYSBvZiBgbGVhdmVzYCB3aXRoIHRoaXMgYXBwcm9hY2guIEZpcnN0LCB3ZSB1c2UgYGltYWdlX3NlZ21lbnRhdGlvbigpYCB0byBpZGVudGlmeSBjYW5kaWRhdGUgaW5kZXhlcyB0byBzZWdtZW50IHRoZSBpbWFnZS4NCg0KYGBge3IgbGVhZjMgfQ0KbGVhdmVzIDwtIGltYWdlX2ltcG9ydCgiZGF0YS9sZWFmX2FyZWEvbGFfbGVhdmVzLkpQRyIpDQppbWFnZV9zaG93KGxlYXZlcykNCg0KYGBgDQoNCmBgYHtyIGxlYWY0LCBmaWcud2lkdGg9OCwgZmlnLmhlaWdodD04fQ0KaW1hZ2Vfc2VnbWVudChsZWF2ZXMsIGluZGV4ID0gImFsbCIpDQpgYGANCg0KYEdgIChHcmVlbikgYW5kIGBOQmAgKE5vcm1hbGl6ZWQgQmx1ZSkgYXJlIHR3byBwb3NzaWJsZSBjYW5kaWRhdGVzIHRvIHNlZ21lbnQgdGhlIGxlYXZlcyBmcm9tIHRoZSBiYWNrZ3JvdW5kLiBXZSB3aWxsIHVzZSB0aGUgYE5CYCBpbmRleCBoZXJlIChkZWZhdWx0IG9wdGlvbiBpbiBgY291bnRfb2JqZWN0cygpYCkuIFRoZSBtZWFzdXJlbWVudCBvZiB0aGUgbGVhZiBhcmVhIGluIHRoaXMgYXBwcm9hY2ggaXMgZ2l2ZW4gd2l0aCB0aGUgZm9sbG93aW5nIHR3byBzdGVwcy4NCg0KMS4gQ291bnQgdGhlIG51bWJlciBvZiBvYmplY3RzIChsZWF2ZXMgaW4gdGhpcyBjYXNlKQ0KDQpIZXJlLCB3ZSBuZWVkIHRvIGNvbWJpbmUgYGNvdW50X29iamVjdHMoKWAgYW5kIGBwbG90X21lYXN1cmVzKClgIHRvIG9idGFpbiB0aGUgaWRlbnRpZmljYXRpb24gb2YgZWFjaCBsZWFmLCBhbGxvd2luZyB0aGUgZnVydGhlciBhZGp1c3RtZW50IG9mIHRoZSBsZWFmIGFyZWEuDQoNCmBgYHtyIGxlYWY1fQ0KY291bnQgPC0gY291bnRfb2JqZWN0cyhsZWF2ZXMsIG1hcmtlciA9ICJ0ZXh0IikNCg0KYGBgDQoNCg0KMi4gQWRqdXN0IHRoZSBsZWFmIGFyZWEgYnkgdGhlIGFyZWEgb2YgdGhlIGtub3duIG9iamVjdA0KDQpUaGUgZnVuY3Rpb24gYGdldF9tZWFzdXJlcygpYCBpcyB1c2VkIHRvIGFkanVzdCB0aGUgbGVhZiBhcmVhIHVzaW5nIHRoZSBvYmplY3QgNi4NCg0KYGBge3IgbGVhZjZ9DQphcmVhIDwtIA0KZ2V0X21lYXN1cmVzKGNvdW50LA0KICAgICAgICAgICAgIGlkID0gNiwNCiAgICAgICAgICAgICBhcmVhIH4gNCkNCmFyZWENCiMgcGxvdCB0aGUgYXJlYSB0byB0aGUgc2VnbWVudGVkIGltYWdlDQppbWFnZV9zZWdtZW50KGxlYXZlcywgaW5kZXggPSAiTkIiLCB2ZXJib3NlID0gRkFMU0UpDQpwbG90X21lYXN1cmVzKGFyZWEsIG1lYXN1cmUgPSAiYXJlYSIpDQoNCiMgY29tcHV0ZSB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIHRoZSB0d28gbWV0aG9kcw0KMTQyLjkgLShzdW0oYXJlYSRhcmVhKSAtIDQpDQpgYGANCg0KDQpUaGUgd2Vha25lc3Mgb2YgY29tcHV0aW5nIGxlYWYgYXJlYSB3aXRoIGBjb3VudF9vYmplY3RzKClgIGlzIHRoYXQgaXQgaXMgbmVlZGVkIHRvIGZpcnN0IG9idGFpbiB0aGUgb2JqZWN0IGlkZW50aWZpY2F0aW9uIHRvIGtub3cgd2hpY2ggb2JqZWN0IChsZWFmKSBpcyB0aGUgc2FtcGxlIHdpdGggYSBrbm93biBhcmVhLiBUaGlzIG9iamVjdCBpZCBtYXkgY2hhbmdlIGZyb20gaW1hZ2UgdG8gaW1hZ2UsIGVzcGVjaWFsbHkgZnJvbSBpbWFnZXMgd2l0aCBhIGRpZmZlcmVudCBudW1iZXIgb2YgbGVhdmVzLiBUaHVzLCBiYXRjaCBjb21wdXRpbmcgaXMgZGlmZmljdWx0IGluIHRoaXMgY2FzZS4NCg0KDQoNCiMgRGlzZWFzZSBzZXZlcml0eQ0KIyMgU2luZ2xlIGltYWdlcw0KDQpgYGB7ciBkaXNlYXNlMSwgZmlnLndpZHRoPTEyLCBmaWcuaGVpZ2h0PTN9DQojIHRlbXBvcmFyeSBkaXJlY3RvcnkNCnNldHdkKCJkYXRhL2Rpc2Vhc2Vfc2V2ZXJpdHkvc295YmVhbiIpDQoNCiMgaW1wb3J0IGltYWdlcw0KaW1nIDwtIGltYWdlX2ltcG9ydCgic2V2X2xlYWYuanBnIikNCmhlYWx0aHkgPC0gaW1hZ2VfaW1wb3J0KCJzZXZfaGVhbHRoeS5qcGciKQ0Kc3ltcHRvbXMgPC0gaW1hZ2VfaW1wb3J0KCJzZXZfc3ltcHQuanBnIikNCmJhY2tncm91bmQgPC0gaW1hZ2VfaW1wb3J0KCJzZXZfYmFjay5qcGciKQ0KaW1hZ2VfY29tYmluZShpbWcsIGhlYWx0aHksIHN5bXB0b21zLCBiYWNrZ3JvdW5kLCBuY29sID0gNCkNCg0KYGBgDQoNCmBgYHtyIGRpc2Vhc2UyLCBmaWcud2lkdGg9MTAsIGZpZy5oZWlnaHQ9NX0NCiMgZGVmYXVsdCBzZXR0aW5ncw0KcmVzIDwtIA0Kc3ltcHRvbWF0aWNfYXJlYShpbWcgPSBpbWcsDQogICAgICAgICAgICAgICAgIGltZ19oZWFsdGh5ID0gaGVhbHRoeSwNCiAgICAgICAgICAgICAgICAgaW1nX3N5bXB0b21zID0gc3ltcHRvbXMsDQogICAgICAgICAgICAgICAgIGltZ19iYWNrZ3JvdW5kID0gYmFja2dyb3VuZCwNCiAgICAgICAgICAgICAgICAgc2F2ZV9pbWFnZSA9IFRSVUUsDQogICAgICAgICAgICAgICAgIGRpcl9wcm9jZXNzZWQgPSAiZGF0YS9kaXNlYXNlX3NldmVyaXR5L3NveWJlYW5fcnVzdC9zaW5nbGUiKQ0KDQojIGNyZWF0ZSBhIHBlcnNvbmFsaXplZCBtYXNrDQpzeW1wdG9tYXRpY19hcmVhKGltZyA9IGltZywNCiAgICAgICAgICAgICAgICAgaW1nX2hlYWx0aHkgPSBoZWFsdGh5LA0KICAgICAgICAgICAgICAgICBpbWdfc3ltcHRvbXMgPSBzeW1wdG9tcywNCiAgICAgICAgICAgICAgICAgaW1nX2JhY2tncm91bmQgPSBiYWNrZ3JvdW5kLA0KICAgICAgICAgICAgICAgICBzYXZlX2ltYWdlID0gVFJVRSwNCiAgICAgICAgICAgICAgICAgc2hvd19vcmlnaW5hbCA9IEZBTFNFLA0KICAgICAgICAgICAgICAgICBjb2xfYmFja2dyb3VuZCA9ICJibGFjayIsDQogICAgICAgICAgICAgICAgIGRpcl9wcm9jZXNzZWQgPSAiZGF0YS9kaXNlYXNlX3NldmVyaXR5L3NveWJlYW5fcnVzdC9zaW5nbGUyIikNCg0KIyBpbXBvcnQgZ2VuZXJhdGVkIG1hc2tzDQptYXNrIDwtIGltYWdlX2ltcG9ydCgiZGF0YS9kaXNlYXNlX3NldmVyaXR5L3NveWJlYW5fcnVzdC9zaW5nbGUvcHJvY19pbWcuanBnIikNCm1hc2syIDwtIGltYWdlX2ltcG9ydCgiZGF0YS9kaXNlYXNlX3NldmVyaXR5L3NveWJlYW5fcnVzdC9zaW5nbGUyL3Byb2NfaW1nLmpwZyIpDQoNCiMgY29tYmluZSB0aGUgbWFza3Mgd2l0aCBvcmlnaW5hbCBpbWFnZQ0KaW1hZ2VfY29tYmluZShpbWcsIG1hc2ssIG1hc2syLCBuY29sID0gMykNCg0KYGBgDQoNCg0KDQojIyBCYXRjaCBwcm9jZXNzaW5nDQojIyMgbGVhZiBpbWFnZXMNCg0KRmlmdHkgc295YmVhbiBsZWF2ZXMgcHJldmlvdXNseSBwcm9jZXNzZWQgaW4gUVVBTlQgc29mdHdhcmUgd2VyZSB1c2VkLiBUaGUgaW1hZ2VzIHdlcmUgcmV0cmlldmVkIGZyb20gaHR0cHM6Ly9vc2YuaW8vNGhicjYsIGEgUGxhbnQgRGlzZWFzZSBTZXZlcml0eSBBbm5vdGF0aW9uIEltYWdlIERhdGFiYXNlLiBUaGFua3MgdG8gW0VtZXJzb24gTS4gRGVsIFBvbnRlXShodHRwczovL29zZi5pby9qYjZ5ZC8pIGFuZCBoaXMgY29sbGFib3JhdG9ycyBmb3Iga2VlcGluZyB0aGlzIGltcG9ydGFudCBwcm9qZWN0IHB1YmxpY2x5IGF2YWlsYWJsZS4NCg0KYGBge3IgYmF0Y2gxLCBmaWcud2lkdGg9MTAsIGZpZy5oZWlnaHQ9MjB9DQojIHRlbXBvcmFyeSBkaXJlY3RvcnkNCnNldHdkKCJkYXRhL2Rpc2Vhc2Vfc2V2ZXJpdHkvc295YmVhbl9ydXN0IikNCnNveV9sZWF2ZXMgPC0gaW1hZ2VfaW1wb3J0KGltZ19wYXR0ZXJuID0gIjEiKQ0KaW1hZ2VfY29tYmluZShzb3lfbGVhdmVzLCBuY29sID0gNSkNCg0KYGBgDQoNCg0KIyMjIFNldmVyaXR5IG1lYXN1cmVtZW50DQoNCg0KYGBge3IgYmF0Y2gyfQ0Kc3lzdGVtLnRpbWUoDQpzb3lfcnVzdCA8LQ0KICBzeW1wdG9tYXRpY19hcmVhKGltZ19wYXR0ZXJuID0gIjEiLA0KICAgICAgICAgICAgICAgICAgIGltZ19zeW1wdG9tcyA9ICJzb3lfcnVzdCIsDQogICAgICAgICAgICAgICAgICAgaW1nX2hlYWx0aHkgPSAic295X2xlYWYiLA0KICAgICAgICAgICAgICAgICAgIGltZ19iYWNrZ3JvdW5kID0gInNveV9iZyIsDQogICAgICAgICAgICAgICAgICAgZGlyX29yaWdpbmFsID0gImRhdGEvZGlzZWFzZV9zZXZlcml0eS9zb3liZWFuX3J1c3QiLA0KICAgICAgICAgICAgICAgICAgIGRpcl9wcm9jZXNzZWQgPSAiZGF0YS9kaXNlYXNlX3NldmVyaXR5L3NveWJlYW5fcnVzdC9wcm9jZXNzZWQiLA0KICAgICAgICAgICAgICAgICAgIHNhdmVfaW1hZ2UgPSBUUlVFLA0KICAgICAgICAgICAgICAgICAgIHNob3dfaW1hZ2UgPSBGQUxTRSwNCiAgICAgICAgICAgICAgICAgICBwYXJhbGxlbCA9IFRSVUUpDQopDQpzb3lfcnVzdA0KYGBgDQoNCg0KIyMjIFByb2Nlc3NlZCBpbWFnZXMNCg0KYGBge3IgYmF0Y2gzLCBmaWcud2lkdGg9MTAsIGZpZy5oZWlnaHQ9MjB9DQojIHRlbXBvcmFyeSBkaXJlY3RvcnkNCnNldHdkKCJkYXRhL2Rpc2Vhc2Vfc2V2ZXJpdHkvc295YmVhbl9ydXN0L3Byb2Nlc3NlZCIpDQpzb3lfbGVhdmVzIDwtIGltYWdlX2ltcG9ydChpbWdfcGF0dGVybiA9ICJwcm9jIikNCmltYWdlX2NvbWJpbmUoc295X2xlYXZlcywgbmNvbCA9IDUpDQoNCg0KDQoNCmBgYA0KDQoNCiMjIENvbmNvcmRhbmNlIGNvcnJlbGF0aW9uIGNvZWZmaWNpZW50DQoNCmBgYHtyIGNvcmNvcmRhbmNlfQ0KYmluZCA8LSBpbXBvcnQoImRhdGEvZGlzZWFzZV9zZXZlcml0eS9zb3liZWFuX3J1c3QvZGF0YV9xdWFudF9wbGltYW4ueGxzeCIpDQpjb25jb3JkYW5jZSA8LSBDQ0MoYmluZCRRdWFudCwgYmluZCRwbGltYW4pDQpjb25jb3JkYW5jZSRyaG8uYw0KYGBgDQoNCg0KIyBDb3VudCBvYmplY3RzDQojIyBJbWFnZXMNCmBgYHtyIGNvdW50X2ltZ3MsIGZpZy53aWR0aD0xMCwgZmlnLmhlaWdodD0xMX0NCmltZ3MgPC0gbGlzdCgNCmJlZW5fYmx1ZSA9IGltYWdlX2ltcG9ydCgiZGF0YS9jb3VudF9vYmplY3RzL2JlZW5fYmx1ZS9JTUdfMTI1NC5qcGciKSwNCmJlZW5fd2hpdGUgPSBpbWFnZV9pbXBvcnQoImRhdGEvY291bnRfb2JqZWN0cy9iZWVuX3doaXRlL0lNR18xMTkyLmpwZyIpLA0Kc295X2JsdWUgPSBpbWFnZV9pbXBvcnQoImRhdGEvY291bnRfb2JqZWN0cy9zb3lfYmx1ZS9JTUdfMTI2Ni5qcGciKSwNCnNveV93aGl0ZSA9IGltYWdlX2ltcG9ydCgiZGF0YS9jb3VudF9vYmplY3RzL3NveV93aGl0ZS9JTUdfMTE3OC5qcGciKSwNCndoZWF0X2JsdWUgPSBpbWFnZV9pbXBvcnQoImRhdGEvY291bnRfb2JqZWN0cy93aGVhdF9ibHVlL0lNR18xMjgwLmpwZyIpLA0Kd2hlYXRfd2hpdGUgPSBpbWFnZV9pbXBvcnQoImRhdGEvY291bnRfb2JqZWN0cy93aGVhdF93aGl0ZS9JTUdfMTE1OC5qcGciKQ0KKQ0KaW1hZ2VfY29tYmluZShpbWdzLCBuY29sID0gMikNCmBgYA0KDQoNCiMjIENvbmNvcmRhbmNlDQoNCmBgYHtyIGNvdW50MX0NCnZhbGlkYXRpb24gPC0gaW1wb3J0KCJkYXRhL2NvdW50X29iamVjdHMvY291bnRfZGF0YS54bHN4IikNCnZhbGlkYXRpb24NCiMgaGVscGVyIGZ1bmN0aW9uIHRvIGNvbXB1dGUgdGhlIGNvbmNvcmRhbmNlIGNvcnJlbGF0aW9uIGNvZWZmaWNpZW50DQpnZXRfY2NjIDwtIGZ1bmN0aW9uKGRmLCByZWFsLCBwcmVkaWN0ZWQpew0KICByZWFsIDwtIHB1bGwoZGYsIHt7cmVhbH19KQ0KICBwcmVkaWN0ZWQgPC0gcHVsbChkZiwge3twcmVkaWN0ZWR9fSkNCiAgQ0NDKHJlYWwsIHByZWRpY3RlZCkkcmhvLmMNCn0NCiMjIyBvdmVyYWxsIGNvbmNvcmRhbmNlDQpnZXRfY2NjKHZhbGlkYXRpb24sIFJFQUwsIFBSRURJQ1RFRCkNCiMjIyBjb25jb3JkYW5jZSBieSBjcm9wLCByZXNvbHV0aW9uIGFuZCBiYWNrZ3JvdW5kIGNvbG9yDQp2YWxpZGF0aW9uICU+JSANCiAgZ3JvdXBfYnkoUkVTT0xVVElPTiwgQ1JPUCwgQkFDS0dST1VORCkgJT4lIA0KICBkbyhnZXRfY2NjKC4sIFJFQUwsIFBSRURJQ1RFRCkpDQojIyMgaWRlbnRpdHkgbGluZQ0KZ2dwbG90KHZhbGlkYXRpb24sIGFlcyhSRUFMLCBQUkVESUNURUQpKSsNCiAgZ2VvbV9wb2ludChhZXMoY29sb3IgPSBmYWN0b3IoQ1JPUCkpKSArDQogIGdlb21fc21vb3RoKG1ldGhvZCA9ICJsbSIsIHNlID0gRkFMU0UpICsNCiAgZ2VvbV9hYmxpbmUoaW50ZXJjZXB0ID0gMCAsIHNsb3BlID0gMSwgbGluZXR5cGUgPSAyKSArDQogIGZhY2V0X2dyaWQoQkFDS0dST1VORCB+IFJFU09MVVRJT04pICsNCiAgbGFicyh4ID0gIkFjdHVhbCBudW1iZXIgb2YgZ3JhaW5zIiwNCiAgICAgICB5ID0gIkNvdW50ZWQgbnVtYmVyIG9mIGdyYWlucyIpICsNCiAgdGhlbWUobGVnZW5kLnBvc2l0aW9uID0gImJvdHRvbSIsDQogICAgICAgIGxlZ2VuZC50aXRsZSA9IGVsZW1lbnRfYmxhbmsoKSwNCiAgICAgICAgYXhpcy50aWNrcy5sZW5ndGggPSB1bml0KDAuMiwgImNtIiksDQogICAgICAgIHBhbmVsLmdyaWQubWlub3IgPSBlbGVtZW50X2JsYW5rKCksDQogICAgICAgIHBhbmVsLnNwYWNpbmcgPSB1bml0KDAuMiwgImNtIiksDQogICAgICAgIGF4aXMudGV4dCA9IGVsZW1lbnRfdGV4dChjb2xvciA9ICJibGFjayIsIHNpemUgPSAxMiksDQogICAgICAgIGF4aXMudGl0bGUgPSBlbGVtZW50X3RleHQoY29sb3IgPSAiYmxhY2siLCBzaXplID0gMTIpKSsNCiAgY29vcmRfZml4ZWQoKSArDQogIHNjYWxlX3hfY29udGludW91cyhsaW1pdHMgPSBjKDAsIDExMCksDQogICAgICAgICAgICAgICAgICAgICBicmVha3MgPSBzZXEoMCwgMTEwLCBieSA9IDI1KSkgKw0KICBzY2FsZV95X2NvbnRpbnVvdXMobGltaXRzID0gYygwLCAxMTApLA0KICAgICAgICAgICAgICAgICAgICAgYnJlYWtzID0gc2VxKDAsIDExMCwgYnkgPSAyNSkpDQoNCmBgYA0KDQojIFJHQiBmb3IgZWFjaCBpbWFnZSBvYmplY3RzDQoNCmBgYHtyIHJnYjEsIGZpZy53aWR0aCA9IDEwLCBmaWcuaGVpZ2h0PTEwfQ0KDQppbWcgPC0gaW1hZ2VfaW1wb3J0KCJkYXRhL29iamVjdHNfcmdiL3RoZXRyYXpvbGl1bS5qcGciKQ0KDQojIGlkZW50aWZ5IHRoZSBpbmRleCB0aGF0IGJldHRlciBzZWdtZW50cyB0aGUgaW1hZ2UNCmltYWdlX3NlZ21lbnQoaW1nLCBpbmRleCA9ICJhbGwiLCBuY29sID0gNCkNCmBgYA0KDQoNCiMjIEdldCB0aGUgUkdCIHZhbHVlcyBmb3IgZWFjaCBvYmplY3QNCg0KVGhlIGluZGV4IGBOQmAgd2FzIGNob3NlbiB0byBzZWdtZW50IHRoZSBncmFpbnMgZnJvbSBiYWNrZ3JvdW5kLiBUaGUgbWVhbiBvZiBibHVlIHZhbHVlcyB3aWxsIGJlIGNvbXB1dGVkIGJ5IGRlY2xhcmluZyBgb2JqZWN0X2luZGV4ID0gIkIiYC4NCg0KYGBge3IgcmdiMiwgZmlnLndpZHRoID0gMTAsIGZpZy5oZWlnaHQ9MTB9DQppZHMgPC0gDQogIG9iamVjdHNfcmdiKGltZywgDQogICAgICAgICAgICAgIGluZGV4ID0gIk5CIiwgIyAoZGVmYXVsdCkgdXNlZCB0byBzZWdtZW50IG9iamVjdHMgZnJvbSBiYWNrZ3JvdW5kDQogICAgICAgICAgICAgIG9iamVjdF9pbmRleCA9ICJCIiwgIyBTaG93IHRoZSBtZWFuIG9mIGJsdWUgdmFsdWVzIGZvciBlYWNoIG9iamVjdA0KICAgICAgICAgICAgICBvYmplY3Rfc2l6ZSA9ICJlbGFyZ2UiKQ0KcGxvdChpZHMpDQpgYGANCg0KDQojIyBwbG90IHRoZSBpbmRleCANCkhlcmUsIEkgdXNlIGBpbWFnZV9zZWdtZW50KClgIGFuZCBgcGxvdF9tZWFzdXJlcygpYCB0byBwbG90IHRoZSBtZWFuIG9mIGJsdWUgdmFsdWVzIGZvciBlYWNoIG9iamVjdC4NCg0KYGBge3IgcmdiMywgZmlnLndpZHRoID0gMTAsIGZpZy5oZWlnaHQ9OH0NCmltYWdlX3NlZ21lbnQoaW1nLA0KICAgICAgICAgICAgICBpbmRleCA9ICJOQiIsDQogICAgICAgICAgICAgIHZlcmJvc2UgPSBGQUxTRSkNCnBsb3RfbWVhc3VyZXMoaWRzLA0KICAgICAgICAgICAgICBtZWFzdXJlID0gImluZGV4IiwgIyBwbG90IHRoZSBtZWFuIG9mIGJsdWUgdmFsdWVzIGZvciBlYWNoIG9iamVjdA0KICAgICAgICAgICAgICBjb2wgPSAiYmxhY2siKQ0KYGBgDQoNCkl0IHNlZW1zIHRoYXQgZ3JhaW5zIHdpdGggbWVhbiBibHVlIHZhbHVlcyBoaWdoZXIgdGhhbiAwLjMgcHJlc2VudHMgc29tZSBsZXZlbCBvZiBkYW1hZ2UuIFVzZXJzIGNhbiB0aGVuIHdvcmsgd2l0aCB0aGlzIGZlYXR1cmUgYW5kIGFkYXB0IGl0IHRvIHlvdXIgb3duIGNhc2UuDQoNCmBgYHtyIHJnYjR9DQpsZW5ndGgod2hpY2goaWRzJGluZGV4ZXMkaW5kZXggPiAwLjMpKQ0KYGBgDQoNCg==</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("code.Rmd");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
